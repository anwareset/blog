<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="noodp">
<meta http-equiv=x-ua-compatible content="IE=edge, chrome=1">
<title>Penerapan Linux OverlayFS pada Container Image - Anwar's Blog</title><meta name=Description content="Bagaimana kombinasi mounting filesystem bekerja dan penerapannya pada teknologi container."><meta property="og:title" content="Penerapan Linux OverlayFS pada Container Image">
<meta property="og:description" content="Bagaimana kombinasi mounting filesystem bekerja dan penerapannya pada teknologi container.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://init.web.id/penerapan-linux-overlayfs-pada-container-image/"><meta property="og:image" content="https://init.web.id/penerapan-linux-overlayfs-pada-container-image/cover.jpg"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-03-26T11:45:04+07:00">
<meta property="article:modified_time" content="2021-03-26T11:45:04+07:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://init.web.id/penerapan-linux-overlayfs-pada-container-image/cover.jpg">
<meta name=twitter:title content="Penerapan Linux OverlayFS pada Container Image">
<meta name=twitter:description content="Bagaimana kombinasi mounting filesystem bekerja dan penerapannya pada teknologi container.">
<meta name=application-name content="Anwar's Blog">
<meta name=apple-mobile-web-app-title content="Anwar's Blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://init.web.id/penerapan-linux-overlayfs-pada-container-image/><link rel=prev href=https://init.web.id/linux-dan-elitisme/><link rel=next href=https://init.web.id/deployment-dengan-s2i-process-openshift/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Penerapan Linux OverlayFS pada Container Image","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/init.web.id\/penerapan-linux-overlayfs-pada-container-image\/"},"image":[{"@type":"ImageObject","url":"https:\/\/init.web.id\/penerapan-linux-overlayfs-pada-container-image\/cover.jpg","width":800,"height":283}],"genre":"posts","keywords":"Container, OverlayFS, Mount, Review","wordcount":1387,"url":"https:\/\/init.web.id\/penerapan-linux-overlayfs-pada-container-image\/","datePublished":"2021-03-26T11:45:04+07:00","dateModified":"2021-03-26T11:45:04+07:00","license":"\u003ca href=\"https://creativecommons.org/licenses/by-nc/4.0/\" target=\"_blank\" rel=\"noopener\"\u003eCC BY-NC 4.0\u003c/a\u003e","publisher":{"@type":"Organization","name":"anwareset","logo":"https:\/\/github.com\/anwareset.png"},"author":{"@type":"Person","name":"anwareset"},"description":"Bagaimana kombinasi mounting filesystem bekerja dan penerapannya pada teknologi container."}</script></head>
<body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'white'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'white'==='dark')&&document.body.setAttribute('theme','dark')</script>
<div id=mask></div><div class=wrapper><header class=desktop id=header-desktop>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title="Anwar's Blog"><span class=header-title-pre><i class="fas fa-hashtag"></i>&nbsp</span><span id=id-1 class=typeit></span></a>
</div>
<div class=menu>
<div class=menu-inner><a class=menu-item href=/posts/> Posts </a><a class=menu-item href=/categories/> Categories </a><a class=menu-item href=/about/> About </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search>
<i class="fas fa-search fa-fw"></i>
</a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear>
<i class="fas fa-times-circle fa-fw"></i>
</a>
<span class="search-button search-loading" id=search-loading-desktop>
<i class="fas fa-spinner fa-fw fa-spin"></i>
</span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i>
</a>
</div>
</div>
</div>
</header><header class=mobile id=header-mobile>
<div class=header-container>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title="Anwar's Blog"><span class=header-title-pre><i class="fas fa-hashtag"></i>&nbsp</span><span id=id-2 class=typeit></span></a>
</div>
<div class=menu-toggle id=menu-toggle-mobile>
<span></span><span></span><span></span>
</div>
</div>
<div class=menu id=menu-mobile><div class=search-wrapper>
<div class="search mobile" id=search-mobile>
<input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search>
<i class="fas fa-search fa-fw"></i>
</a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear>
<i class="fas fa-times-circle fa-fw"></i>
</a>
<span class="search-button search-loading" id=search-loading-mobile>
<i class="fas fa-spinner fa-fw fa-spin"></i>
</span>
</div>
<a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>
Cancel
</a>
</div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/about/ title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i>
</a></div>
</div>
</header>
<div class="search-dropdown desktop">
<div id=search-dropdown-desktop></div>
</div>
<div class="search-dropdown mobile">
<div id=search-dropdown-mobile></div>
</div>
<main class=main>
<div class=container><div class=toc id=toc-auto>
<h2 class=toc-title>Contents</h2>
<div class=toc-content id=toc-content-auto></div>
</div><article class="page single"><h1 class="single-title animated flipInX">Penerapan Linux OverlayFS pada Container Image</h1><div class=post-meta>
<div class=post-meta-line><span class=post-author><a href=https://init.web.id/about title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>anwareset</a></span>&nbsp;<span class=post-category>included in <a href=/categories/gnu/linux/><i class="far fa-folder fa-fw"></i>GNU/Linux</a></span></div>
<div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-03-26>2021-03-26</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1387 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;7 minutes&nbsp;</div>
</div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/penerapan-linux-overlayfs-pada-container-image/cover.jpg data-srcset="/penerapan-linux-overlayfs-pada-container-image/cover.jpg, /penerapan-linux-overlayfs-pada-container-image/cover.jpg 1.5x, /penerapan-linux-overlayfs-pada-container-image/cover.jpg 2x" data-sizes=auto alt=/penerapan-linux-overlayfs-pada-container-image/cover.jpg title="Bagaimana kombinasi mounting filesystem bekerja dan penerapannya pada teknologi container."></div><div class="details toc" id=toc-static kept>
<div class="details-summary toc-title">
<span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span>
</div>
<div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents>
<ul>
<li><a href=#overlay-filesystem>Overlay Filesystem</a>
<ul>
<li><a href=#membuat-overlay-filesystem>Membuat Overlay Filesystem</a></li>
<li><a href=#menarik-kesimpulan>Menarik Kesimpulan</a></li>
</ul>
</li>
<li><a href=#container-image>Container Image</a>
<ul>
<li><a href=#layer-cache>Layer Cache</a></li>
<li><a href=#oci-format>OCI format</a></li>
</ul>
</li>
<li><a href=#overlay-filesystem-lainnya>Overlay Filesystem Lainnya</a></li>
<li><a href=#build-container-image>Build Container Image</a></li>
<li><a href=#kesimpulan>Kesimpulan</a></li>
<li><a href=#referensi>Referensi</a></li>
</ul>
</nav></div>
</div><div class=content id=content><p>Adalah tidak mungkin untuk menggunakan container tanpa container image. Artikel ini akan mengulas bagaimana kombinasi mounting filesystem dan penerapannya pada teknologi container dalam membangun container image.</p>
<h2 id=overlay-filesystem>Overlay Filesystem</h2>
<p><strong>Overlay</strong> filesystem juga sering disebut sebagai <a href=https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/Documentation/filesystems/overlayfs.rst target=_blank rel="noopener noreffer">union filesystem</a> memungkinkan pembuatan kombinasi dua atau lebih direktori, yang akan menjadi list dari yang biasa dijuluki sebagai direktori <em>lower</em> dan direktori <em>upper</em>. Direktori <em>lower</em> biasanya memiliki permission <em>read only</em>, sedangkan direktori <em>upper</em> dapat diberikan permission <em>read-write</em>. Saya teringat, salah satu <em>use case</em> Overlay filesystem yang pernah saya lakukan adalah memakainya untuk membuat <a href=https://openwrt.org/docs/guide-user/additional-software/extroot_configuration target=_blank rel="noopener noreffer"><em>extroot</em></a> atau external root pada OpenWrt guna memperluas filesystem sebuah wireless router dengan cara menaruh penyimpanannya ke media eksternal seperti USB storage.</p>
<p>Untuk memahami Overlay filesystem kita dapat mempraktekannya dengan bantuan perintah <code>mount</code> pada sistem operasi GNU/Linux. Mari melihat apa yang dimaksud dengan pernyataan sebelumnya dengan mencobanya.</p>
<h3 id=membuat-overlay-filesystem>Membuat Overlay Filesystem</h3>
<p>Saya akan membuat beberapa folder dan mengkombinasikannya. Pertama saya ingin membuat sebuah folder bernama <code>mount</code> dimana nantinya akan berisikan gabungan dari keseluruhan folder lainnya. Kemudian saya membuat sebuah sekelompok folder bernama <code>1-lower-layer</code>, <code>2-lower-layer</code>, dan <code>3-upper-layer</code>. Dan akhirnya saya membuat sebuah folder bernama <code>workdir</code> yang diperlukan oleh overay filesystem untuk dapat bekerja dengan benar.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=nb>cd</span> /tmp <span class=o>&amp;&amp;</span> mkdir overlay-example <span class=o>&amp;&amp;</span> <span class=nb>cd</span> overlay-example
mkdir -v mount 1-lower-layer 2-lower-layer 3-upper-layer workdir
ls -l
</code></pre></td></tr></table>
</div>
</div><p><figure><a class=lightgallery href=/penerapan-linux-overlayfs-pada-container-image/membuat-folder.png title="Membat Folder" data-thumbnail=/penerapan-linux-overlayfs-pada-container-image/membuat-folder.png data-sub-html="<h2>Membuat Folder</h2><p>Membat Folder</p>">
<img class=lazyload src=/svg/loading.min.svg data-src=membuat-folder.png data-srcset="/penerapan-linux-overlayfs-pada-container-image/membuat-folder.png, membuat-folder.png 1.5x, /penerapan-linux-overlayfs-pada-container-image/membuat-folder.png 2x" data-sizes=auto alt=/penerapan-linux-overlayfs-pada-container-image/membuat-folder.png>
</a><figcaption class=image-caption>Membuat Folder</figcaption>
</figure></p>
<p>Sekarang mari membuat beberapa file dalam folder <code>1-lower-layer</code> <code>2-lower-layer</code> memakai perintah <code>echo</code>. Untuk folder <code>3-upper-layer</code> akan kita biarkan kosong sebagai contoh dari direktori <em>upper</em> saja. Kita akan melihat bagaimana nantinya mereka akan bekerja.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=nb>echo</span> <span class=s2>&#34;ini layer 1&#34;</span> &gt; ./1-lower-layer/file1
<span class=nb>echo</span> <span class=s2>&#34;ini layer 2&#34;</span> &gt; ./2-lower-layer/file2
tree
</code></pre></td></tr></table>
</div>
</div><p><figure><a class=lightgallery href=/penerapan-linux-overlayfs-pada-container-image/membuat-file-lower.png title="Membuat file pada direktori <em>lower</em>" data-thumbnail=/penerapan-linux-overlayfs-pada-container-image/membuat-file-lower.png data-sub-html="<h2>Membuat file pada direktori _lower_</h2><p>Membuat file pada direktori <em>lower</em></p>">
<img class=lazyload src=/svg/loading.min.svg data-src=membuat-file-lower.png data-srcset="/penerapan-linux-overlayfs-pada-container-image/membuat-file-lower.png, membuat-file-lower.png 1.5x, /penerapan-linux-overlayfs-pada-container-image/membuat-file-lower.png 2x" data-sizes=auto alt=/penerapan-linux-overlayfs-pada-container-image/membuat-file-lower.png>
</a><figcaption class=image-caption>Membuat file pada direktori _lower_</figcaption>
</figure></p>
<p>Pada akhirnya, mari kita jalankan perintah <code>mount</code> pada mereka.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>sudo mount -vt overlay overay-example -o <span class=se>\
</span><span class=se></span><span class=nv>lowerdir</span><span class=o>=</span>/tmp/overlay-example/1-lower-layer:/tmp/overlay-example/2-lower-layer,upperdir<span class=o>=</span>/tmp/overlay-example/3-upper-layer,workdir<span class=o>=</span>/tmp/overlay-example/workdir <span class=se>\
</span><span class=se></span>/tmp/overlay-example/mount
df -h <span class=p>|</span> grep overlay
tree
</code></pre></td></tr></table>
</div>
</div><p>Jika berhasil kita dapat melihatnya seperti output berikut ini.
<figure><a class=lightgallery href=/penerapan-linux-overlayfs-pada-container-image/mounting-overlay.png title="Mounting Overlay" data-thumbnail=/penerapan-linux-overlayfs-pada-container-image/mounting-overlay.png data-sub-html="<h2>Mounting Overlay</h2><p>Mounting Overlay</p>">
<img class=lazyload src=/svg/loading.min.svg data-src=mounting-overlay.png data-srcset="/penerapan-linux-overlayfs-pada-container-image/mounting-overlay.png, mounting-overlay.png 1.5x, /penerapan-linux-overlayfs-pada-container-image/mounting-overlay.png 2x" data-sizes=auto alt=/penerapan-linux-overlayfs-pada-container-image/mounting-overlay.png>
</a><figcaption class=image-caption>Mounting Overlay</figcaption>
</figure></p>
<p>Sebagaimana kita mengharapkannya, seluruh konten dari folder <code>1-lower-layer</code> dan <code>2-lower-layer</code> dapat dikombinasikan dan dimuat ke dalam folder <code>mount</code>. Mari kita periksa konten dari file tersebut yang sebelumnya telah kita tuliskan sebuah string menggunakan perintah <code>echo</code>.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>cat mount/file2
</code></pre></td></tr></table>
</div>
</div><p>Sudah dipastikan bahwa memang file tersebut identik dengan apa yang sudah kita ciptakan sebelumnya.
<figure><a class=lightgallery href=/penerapan-linux-overlayfs-pada-container-image/memeriksa-isi-konten.png title="Memeriksa isi konten" data-thumbnail=/penerapan-linux-overlayfs-pada-container-image/memeriksa-isi-konten.png data-sub-html="<h2>Memeriksa isi konten</h2><p>Memeriksa isi konten</p>">
<img class=lazyload src=/svg/loading.min.svg data-src=memeriksa-isi-konten.png data-srcset="/penerapan-linux-overlayfs-pada-container-image/memeriksa-isi-konten.png, memeriksa-isi-konten.png 1.5x, /penerapan-linux-overlayfs-pada-container-image/memeriksa-isi-konten.png 2x" data-sizes=auto alt=/penerapan-linux-overlayfs-pada-container-image/memeriksa-isi-konten.png>
</a><figcaption class=image-caption>Memeriksa isi konten</figcaption>
</figure></p>
<p>Lalu bagaimana jika kita membuat sebuah file baru pada folder mount? mari kita coba.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=nb>echo</span> <span class=s2>&#34;Ini adalah file baru&#34;</span> &gt; ./mount/file-baru
tree
</code></pre></td></tr></table>
</div>
</div><p><figure><a class=lightgallery href=/penerapan-linux-overlayfs-pada-container-image/membuat-file-upper.png title="Membuat file baru" data-thumbnail=/penerapan-linux-overlayfs-pada-container-image/membuat-file-upper.png data-sub-html="<h2>Membuat file baru</h2><p>Membuat file baru</p>">
<img class=lazyload src=/svg/loading.min.svg data-src=membuat-file-upper.png data-srcset="/penerapan-linux-overlayfs-pada-container-image/membuat-file-upper.png, membuat-file-upper.png 1.5x, /penerapan-linux-overlayfs-pada-container-image/membuat-file-upper.png 2x" data-sizes=auto alt=/penerapan-linux-overlayfs-pada-container-image/membuat-file-upper.png>
</a><figcaption class=image-caption>Membuat file baru</figcaption>
</figure></p>
<p>Terlihat bahwa file baru yang kita ciptakan di folder <code>mount</code> akan tersimpan pada <em>upper layer</em> atau di sini kita menamai foldernya dengan nama <code>3-upper-layer</code>. Lalu bagaimana jika kita menghapus salah satu file milik <em>lower layer</em>, misalnya adalah <code>file2</code>.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>rm mount/file2
tree
</code></pre></td></tr></table>
</div>
</div><p><figure><a class=lightgallery href=/penerapan-linux-overlayfs-pada-container-image/menghapus-lower-file.png title="Menghapus file" data-thumbnail=/penerapan-linux-overlayfs-pada-container-image/menghapus-lower-file.png data-sub-html="<h2>Menghapus file</h2><p>Menghapus file</p>">
<img class=lazyload src=/svg/loading.min.svg data-src=menghapus-lower-file.png data-srcset="/penerapan-linux-overlayfs-pada-container-image/menghapus-lower-file.png, menghapus-lower-file.png 1.5x, /penerapan-linux-overlayfs-pada-container-image/menghapus-lower-file.png 2x" data-sizes=auto alt=/penerapan-linux-overlayfs-pada-container-image/menghapus-lower-file.png>
</a><figcaption class=image-caption>Menghapus file</figcaption>
</figure></p>
<p>File tersebut berhasil dihapus dari folder <code>mount</code>, tapi ternyata <code>file2</code> masih utuh dan baik-baik saja di dalam folder <code>2-lower-layer</code>. Kemudian jika diperhatikan, akan muncul sebuah file baru pada folder <code>3-upper-layer</code> bernama <code>file2</code> sesuai dengan yang baru saja kita hapus. Mari kita periksa file tersebut.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-shell data-lang=shell>ls -lhtra 3-upper-layer
</code></pre></td></tr></table>
</div>
</div><p><figure><a class=lightgallery href=/penerapan-linux-overlayfs-pada-container-image/memeriksa-upper-layer.png title="Memeriksa upper layer" data-thumbnail=/penerapan-linux-overlayfs-pada-container-image/memeriksa-upper-layer.png data-sub-html="<h2>Memeriksa upper layer</h2><p>Memeriksa upper layer</p>">
<img class=lazyload src=/svg/loading.min.svg data-src=memeriksa-upper-layer.png data-srcset="/penerapan-linux-overlayfs-pada-container-image/memeriksa-upper-layer.png, memeriksa-upper-layer.png 1.5x, /penerapan-linux-overlayfs-pada-container-image/memeriksa-upper-layer.png 2x" data-sizes=auto alt=/penerapan-linux-overlayfs-pada-container-image/memeriksa-upper-layer.png>
</a><figcaption class=image-caption>Memeriksa upper layer</figcaption>
</figure></p>
<p>File baru di dalam folder <code>3-upper-layer</code> ternyata adalah sebuah <em>character file</em>. File semacam ini seringkali disebut sebagai file <em>whiteout</em> dan begitulah overlay filesystem menampilkan berkas yang akan dihapus.</p>
<h3 id=menarik-kesimpulan>Menarik Kesimpulan</h3>
<p>Sebagaimana yang saya bicarakan pada awal tadi, overlay filesystem memungkinkan kita untuk membuat sebauh <em>union</em> atau kesatuan beberapa direktori. Dalam kasus kita saat ini <em>union</em> dibuat pada folder <code>mount</code> dan di dalamnya akan berisi konten kolaborasi dari direktori <em>layer</em> yaitu folder <code>1-lower-layer</code> dan <code>2-lower-layer</code> sebagai lapisan direktori <em>lower</em>, serta folder <code>3-upper-layer</code> sebagai lapisan direktori <em>upper</em>.</p>
<p>Setiap perubahan yang kita lakukan pada <em>union</em> (membuat, menghapus, atau mengedit konten) akan dicatat pada <em>upper layer</em>. Ini adalah alasan kenapa lapisan <em>upper</em> juga sering disebut sebagai lapisan <em>diff</em>. Fakta lainnya adalah, berkas-berkas dari union merupakan bayangan dari <em>lower layer</em> namun <em>upper layer</em> memiliki tingkatan lebih tinggi untuk ditampilkan ke panggung, contohnya ketika kita membuat file atau folder pada <code>3-upper-layer</code> dengan nama yang sama seperti dalam <code>1-lower-layer</code> dan <code>2-lower-layer</code> maka justru konten dari <code>3-upper-layer</code> yang akan ditampilkan pada <em>union</em> atau dalam kasus ini yaitu folder <code>mount</code>.
<figure><a class=lightgallery href=/penerapan-linux-overlayfs-pada-container-image/upper-layer-override.png title="Upper Layer override" data-thumbnail=/penerapan-linux-overlayfs-pada-container-image/upper-layer-override.png data-sub-html="<h2>Upper Layer override</h2><p>Upper Layer override</p>">
<img class=lazyload src=/svg/loading.min.svg data-src=upper-layer-override.png data-srcset="/penerapan-linux-overlayfs-pada-container-image/upper-layer-override.png, upper-layer-override.png 1.5x, /penerapan-linux-overlayfs-pada-container-image/upper-layer-override.png 2x" data-sizes=auto alt=/penerapan-linux-overlayfs-pada-container-image/upper-layer-override.png>
</a><figcaption class=image-caption>Upper Layer override</figcaption>
</figure></p>
<hr>
<h2 id=container-image>Container Image</h2>
<p><strong>Container Image</strong> sebenarnya adalah sebuah <em>tarfile</em> dengan root filesystem dan beberapa metadata. Kita mungkin pernah mendengar tentang karakteristik <em>image layer</em> dan setiap baris dari <strong>Dockerfile</strong> (sebuah textfile yang berisi baris perintah untuk membangun container image) akan membuat layer baru. Contohnya seperti berikut, dimana dia akan membuat tiga layer untuk setiap baris perintahnya.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=k>FROM</span><span class=s> scratch</span><span class=err>
</span><span class=err></span><span class=k>ADD</span> my-files /doc<span class=err>
</span><span class=err></span><span class=k>ADD</span> hello /<span class=err>
</span><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;/hello&#34;</span><span class=p>]</span><span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p>Jadi apa yang sebenarnya terjadi saat kita menjalankan perintah <code>docker run</code>. Banyak hal yang sebenarnya terjadi, tapi untuk kepentingan artikel kali ini kita akan meluruskan ketertarikan kita pada container image.</p>
<p><figure><a class=lightgallery href=/penerapan-linux-overlayfs-pada-container-image/container-image-construct.jpg title="Container Image Construct" data-thumbnail=/penerapan-linux-overlayfs-pada-container-image/container-image-construct.jpg data-sub-html="<h2>Container Image Construct</h2><p>Container Image Construct</p>">
<img class=lazyload src=/svg/loading.min.svg data-src=container-image-construct.jpg data-srcset="/penerapan-linux-overlayfs-pada-container-image/container-image-construct.jpg, container-image-construct.jpg 1.5x, /penerapan-linux-overlayfs-pada-container-image/container-image-construct.jpg 2x" data-sizes=auto alt=/penerapan-linux-overlayfs-pada-container-image/container-image-construct.jpg>
</a><figcaption class=image-caption>Container Image Construct</figcaption>
</figure></p>
<p>Secara pandangan <em>high level</em>, docker akan mengunduh <em>tarball</em> untuk image, kemudian melakukan unpack pada setiap layer menjadi beberapa direktori terpisah dan kemudian menggunakan overlay filesystem untuk mengkombinasinya menjadi sebuah kesatuan direktori <em>upper</em> kosong yang akan digunakan oleh container untuk menuliskan segala perubahan ketika tengah berjalan.</p>
<p>Ketika kita melakukan suatu perubahan, seperti membuat atau menghapus file di dalam container, perubahan tersebut akan disimpan pada direktori kosong di <em>upper layer</em>. Ketika container dihentikan, docker akan membersihkan folder tersebut. Itulah alasannya kenapa setiap perubahan yang kita lakukan di dalam container <em>by default</em> tidak disimpan permanen.</p>
<h3 id=layer-cache>Layer Cache</h3>
<p><figure><a class=lightgallery href=/penerapan-linux-overlayfs-pada-container-image/layer-cache.png title="Layer Cache" data-thumbnail=/penerapan-linux-overlayfs-pada-container-image/layer-cache.png data-sub-html="<h2>Layer Cache</h2><p>Layer Cache</p>">
<img class=lazyload src=/svg/loading.min.svg data-src=layer-cache.png data-srcset="/penerapan-linux-overlayfs-pada-container-image/layer-cache.png, layer-cache.png 1.5x, /penerapan-linux-overlayfs-pada-container-image/layer-cache.png 2x" data-sizes=auto alt=/penerapan-linux-overlayfs-pada-container-image/layer-cache.png>
</a><figcaption class=image-caption>Layer Cache</figcaption>
</figure>
Ini adalah metode yang digunakan oleh overlay filesystem untuk memungkinkan <em>host</em> melakukan <em>caching</em> container image secara efektif. Sebagai contoh, jika kita mendefinisikan dua container image, mereka berdua dapat menggunakan beberapa layer yang sama. Sehingga <em>host</em> tidak perlu mengunduh kembali atau menyimpan salinannya berkali-kali pada disk.</p>
<h3 id=oci-format>OCI format</h3>
<p>Menjalankan sebuah container dapat dianalogikan menjadi dua langkah proses: membangun image dan menjalankan container dari image tersebut. Popularitas container telah meyakinkan orang-orang untuk melakukan standarisasi kedua langkah proses tersebut. Karena <em>open source</em>, kedua langkah proses tersebut dapat dikembangkan secara terpisah. <strong>Open Container Initiative (OCI)</strong> merupakan sebuah project dari <a href=https://www.linuxfoundation.org/projects target=_blank rel="noopener noreffer">Linux Foundation</a> yang mengelola standarisasi container supaya dapat disesuaikan dengan lingkungan industri.</p>
<p>Saat artikel ini dibuat, OCI memiki dua macam spesifikasi: Runtime Specification (runtime-spec) dan Image Specification (image-spec). Runtime Specification menguraikan cara untuk menjalankan &ldquo;filesystem bundle&rdquo; yang dapat dibongkar pada disk. Penerapan OCI seperti mengunduh OCI Image kemudian melakukan <em>unpack</em> image tersebut ke dalam OCI Runtime filesystem bundle. Pada titik ini OCI Runtime Bundle akan dijalankan oleh sebuah OCI Runtime.</p>
<p>Standarisasi tersebut memperbolehkan setiap orang untuk mengembangkan custom container builder dan custom runtime. Sebagai contoh, ada jessfraz/img, buildah, hingga Skopeo yang mampu kita pakai untuk membangun container image tanpa perlu bergantung pada Docker. Banyak tool lain yang juga bisa kita gunakan untuk menjalankan container (disebut container runtime) seperti runC (yang dipakai oleh Docker) dan rkt.</p>
<hr>
<h2 id=overlay-filesystem-lainnya>Overlay Filesystem Lainnya</h2>
<p><figure><a class=lightgallery href=/penerapan-linux-overlayfs-pada-container-image/other-overlayfs.png title="OverlayFS lain" data-thumbnail=/penerapan-linux-overlayfs-pada-container-image/other-overlayfs.png data-sub-html="<h2>OverlayFS lain</h2><p>OverlayFS lain</p>">
<img class=lazyload src=/svg/loading.min.svg data-src=other-overlayfs.png data-srcset="/penerapan-linux-overlayfs-pada-container-image/other-overlayfs.png, other-overlayfs.png 1.5x, /penerapan-linux-overlayfs-pada-container-image/other-overlayfs.png 2x" data-sizes=auto alt=/penerapan-linux-overlayfs-pada-container-image/other-overlayfs.png>
</a><figcaption class=image-caption>OverlayFS lain</figcaption>
</figure>
Docker tidak cuma mampu menggunakan Overlay untuk melakukan kombinasi filesystem. Ada beberapa lainnya yang memiliki potensi untuk dapat digunakan seperti AuFS, Btrfs, ZFS, hingga Device mapper.</p>
<hr>
<h2 id=build-container-image>Build Container Image</h2>
<p><figure><a class=lightgallery href=/penerapan-linux-overlayfs-pada-container-image/container-image-layer.jpg title="Container Image Layer" data-thumbnail=/penerapan-linux-overlayfs-pada-container-image/container-image-layer.jpg data-sub-html="<h2>Container Image Layer</h2><p>Container Image Layer</p>">
<img class=lazyload src=/svg/loading.min.svg data-src=container-image-layer.jpg data-srcset="/penerapan-linux-overlayfs-pada-container-image/container-image-layer.jpg, container-image-layer.jpg 1.5x, /penerapan-linux-overlayfs-pada-container-image/container-image-layer.jpg 2x" data-sizes=auto alt=/penerapan-linux-overlayfs-pada-container-image/container-image-layer.jpg>
</a><figcaption class=image-caption>Container Image Layer</figcaption>
</figure>
Misalkan kita memiliki sebuah Dockerfile seperti berikut untuk membangun image. Apa yang sebenarnya terjadi?</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=k>FROM</span><span class=s> centos:7</span><span class=err>
</span><span class=err></span><span class=k>RUN</span> yum install -y wget<span class=err>
</span><span class=err></span>...<span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p>Pada pandangan <em>high level</em>, inilah yang akan terjadi dari Dockerfile tersebut.</p>
<ol>
<li>Docker mengunduh tarball untuk image karena perintah <code>FROM</code> dan membongkarnya. Ini akan menjadi layer paling bawah dari container image.</li>
<li>Memuat <em>union</em> filesystem. Berkas yang sebelumnya telah terunduh pada langkah pertama akan dipakai sebagai <em>lower layer</em>.</li>
<li>Menjalankan shell command di dalam environment <code>chroot</code> karena perintah <code>RUN</code>. Perintah tersebut adalah <code>/bin/sh -c "yum install -y wget</code>.</li>
<li>Ketika baris perintah terakhir telah dijalankan, container runtime akan membuat <em>upper layer</em>. Ini adalah lapisan baru dari image yang kita bangun.</li>
<li>Jika Dockerfile mengandung perintah lainnya, maka proses pada langkah kedua akan diulangi sebagai <em>lower layer</em> dan berikutnya hingga selesai.</li>
</ol>
<p>Tentu anggapan ini cenderung terlalu menyederhanakan workflow dimana saya tidak menyinggung perintah lain seperti <code>ENV</code> hingga <code>ENTRYPOINT</code>. Perintah tersebut akan disimpan di dalam metadata dan kemudian dikemas bersama ke dalam layer.</p>
<hr>
<h2 id=kesimpulan>Kesimpulan</h2>
<p>Gagasan untuk merangkum keseluruhan root filesystem menjadi sebuah tarfile dan memisahkan setiap layer menjadi begitu <em>powerful</em>. Ini tidak hanya dipakai pada teknologi container, tapi konsep ini juga dapat digunakan pada konteks lainnya. Saya kira, di masa mendatang akan semakin banyak tools yang memanfaatkan hal serupa.</p>
<hr>
<h2 id=referensi>Referensi</h2>
<ul>
<li><a href=https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/Documentation/filesystems/overlayfs.rst target=_blank rel="noopener noreffer">git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/Documentation/filesystems/overlayfs.rst</a></li>
<li><a href=https://linux.die.net/man/8/mount target=_blank rel="noopener noreffer">linux.die.net/man/8/mount</a></li>
<li><a href=https://openwrt.org/docs/guide-user/additional-software/extroot_configuration target=_blank rel="noopener noreffer">openwrt.org/docs/guide-user/additional-software/extroot_configuration</a></li>
<li><a href=https://docs.docker.com/develop/develop-images/dockerfile_best-practices/ target=_blank rel="noopener noreffer">docs.docker.com/develop/develop-images/dockerfile_best-practices</a></li>
<li><a href=https://opencontainers.org/faq/ target=_blank rel="noopener noreffer">opencontainers.org/faq</a></li>
<li><a href=https://github.com/opencontainers/runtime-spec/blob/master/spec.md target=_blank rel="noopener noreffer">github.com/opencontainers/runtime-spec/blob/master/spec.md</a></li>
<li><a href=https://github.com/opencontainers/image-spec/blob/master/layer.md target=_blank rel="noopener noreffer">github.com/opencontainers/image-spec/blob/master/layer.md</a></li>
</ul></div><div class=post-footer id=post-footer>
<div class=post-info>
<div class=post-info-line>
<div class=post-info-mod>
<span>Updated on 2021-03-26</span>
</div>
<div class=post-info-license></div>
</div>
<div class=post-info-line>
<div class=post-info-md><span>
<a class=link-to-markdown href=/penerapan-linux-overlayfs-pada-container-image/index.md target=_blank>Read Markdown</a>
</span></div>
<div class=post-info-share>
<span></span>
</div>
</div>
</div>
<div class=post-info-more>
<section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/container/>Container</a>,&nbsp;<a href=/tags/overlayfs/>OverlayFS</a>,&nbsp;<a href=/tags/mount/>Mount</a>,&nbsp;<a href=/tags/review/>Review</a></section>
<section>
<span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span>
</section>
</div>
<div class=post-nav><a href=/linux-dan-elitisme/ class=prev rel=prev title="Linux dan Elitisme"><i class="fas fa-angle-left fa-fw"></i>Linux dan Elitisme</a>
<a href=/deployment-dengan-s2i-process-openshift/ class=next rel=next title="Deployment dengan S2I Process OpenShift">Deployment dengan S2I Process OpenShift<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id=comments><div id=disqus_thread class=comment></div><noscript>
Please enable JavaScript to view the comments powered by <a href=https://disqus.com/?ref_noscript>Disqus</a>.
</noscript></div></article></div>
</main><footer class=footer>
<div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=http://github.com/anwareset target=_blank>anwareset</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div>
</div>
</footer></div>
<div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top">
<i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments">
<i class="fas fa-comment fa-fw"></i>
</a>
</div><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><script type=text/javascript src=https://anwars-blog.disqus.com/embed.js defer></script><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/typeit/typeit.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:10},comment:{},data:{"id-1":"init\u0026nbsp","id-2":"init\u0026nbsp"},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"},typeit:{cursorChar:"\u0026nbsp _",cursorSpeed:1e3,data:{"id-1":["id-1"],"id-2":["id-2"]},duration:-1,speed:75}}</script><script type=text/javascript src=/js/theme.min.js></script></body>
</html>