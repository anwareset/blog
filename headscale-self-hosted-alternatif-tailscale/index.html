<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Headscale Self Hosted sebagai Alternatif Tailscale untuk Zero Trust Mesh Network - Anwar's Blog</title><meta name=Description content="Headscale sebagai solusi self hosted untuk alternatif Tailscale dalam membangun private zero trust mesh network."><meta property="og:url" content="https://deployer.dpdns.org/headscale-self-hosted-alternatif-tailscale/">
<meta property="og:site_name" content="Anwar's Blog"><meta property="og:title" content="Headscale Self Hosted sebagai Alternatif Tailscale untuk Zero Trust Mesh Network"><meta property="og:description" content="Headscale sebagai solusi self hosted untuk alternatif Tailscale dalam membangun private zero trust mesh network."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-11T12:20:00+07:00"><meta property="article:modified_time" content="2025-12-11T12:20:00+07:00"><meta property="article:tag" content="Headscale"><meta property="article:tag" content="Tailscale"><meta property="article:tag" content="VPN"><meta property="article:tag" content="Mesh"><meta property="og:image" content="https://deployer.dpdns.org/headscale-self-hosted-alternatif-tailscale/cover.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://deployer.dpdns.org/headscale-self-hosted-alternatif-tailscale/cover.png"><meta name=twitter:title content="Headscale Self Hosted sebagai Alternatif Tailscale untuk Zero Trust Mesh Network"><meta name=twitter:description content="Headscale sebagai solusi self hosted untuk alternatif Tailscale dalam membangun private zero trust mesh network."><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://deployer.dpdns.org/headscale-self-hosted-alternatif-tailscale/><link rel=prev href=https://deployer.dpdns.org/canary-deployment-dan-mirroring-dengan-traefik/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Headscale Self Hosted sebagai Alternatif Tailscale untuk Zero Trust Mesh Network","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/deployer.dpdns.org\/headscale-self-hosted-alternatif-tailscale\/"},"image":[{"@type":"ImageObject","url":"https:\/\/deployer.dpdns.org\/headscale-self-hosted-alternatif-tailscale\/cover.png","width":1671,"height":864}],"genre":"posts","keywords":"Headscale, Tailscale, VPN, Mesh","wordcount":3284,"url":"https:\/\/deployer.dpdns.org\/headscale-self-hosted-alternatif-tailscale\/","datePublished":"2025-12-11T12:20:00+07:00","dateModified":"2025-12-11T12:20:00+07:00","license":"\u003ca href=\"https://creativecommons.org/licenses/by-nc/4.0/\" target=\"_blank\" rel=\"noopener\"\u003eCC BY-NC 4.0\u003c/a\u003e","publisher":{"@type":"Organization","name":"anwareset","logo":"https:\/\/github.com\/anwareset.png"},"author":{"@type":"Person","name":"anwareset"},"description":"Headscale sebagai solusi self hosted untuk alternatif Tailscale dalam membangun private zero trust mesh network."}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"dark"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Anwar's Blog"><span class=header-title-pre><i class='fas fa-hashtag'></i>&nbsp</span><span id=id-1 class=typeit></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/about/>About </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Anwar's Blog"><span class=header-title-pre><i class='fas fa-hashtag'></i>&nbsp</span><span id=id-2 class=typeit></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/about/ title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Headscale Self Hosted sebagai Alternatif Tailscale untuk Zero Trust Mesh Network</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://deployer.dpdns.org/about title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>anwareset</a></span>&nbsp;<span class=post-category>included in <a href=/categories/tools/><i class="far fa-folder fa-fw" aria-hidden=true></i>Tools</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2025-12-11>2025-12-11</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;3284 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;16 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/headscale-self-hosted-alternatif-tailscale/cover.png data-srcset="/headscale-self-hosted-alternatif-tailscale/cover.png, /headscale-self-hosted-alternatif-tailscale/cover.png 1.5x, /headscale-self-hosted-alternatif-tailscale/cover.png 2x" data-sizes=auto alt=/headscale-self-hosted-alternatif-tailscale/cover.png title="Headscale sebagai solusi self hosted untuk alternatif Tailscale dalam membangun private zero trust mesh network."></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#zero-trust-mesh-network>Zero Trust Mesh Network</a><ul><li><a href=#mesh-network-architecture>Mesh Network Architecture</a></li><li><a href=#headscale-dan-tailscale>Headscale dan Tailscale</a></li></ul></li><li><a href=#arsitektur>Arsitektur</a></li><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#instalasi--konfigurasi-headscale>Instalasi & Konfigurasi Headscale</a><ul><li><a href=#struktur-direktori>Struktur Direktori</a></li><li><a href=#docker-secrets>Docker Secrets</a></li><li><a href=#environment-file>Environment File</a></li><li><a href=#docker-compose-configuration>Docker Compose Configuration</a></li><li><a href=#konfigurasi-headscale>Konfigurasi Headscale</a></li><li><a href=#konfigurasi-headplane>Konfigurasi Headplane</a></li></ul></li><li><a href=#caddy>Caddy</a><ul><li><a href=#docker-compose-configuration-1>Docker Compose Configuration</a></li><li><a href=#caddyfile-configuration>Caddyfile Configuration</a></li></ul></li><li><a href=#deployment>Deployment</a><ul><li><a href=#verify-installation>Verify Installation</a></li></ul></li><li><a href=#headscale-administration>Headscale Administration</a><ul><li><a href=#headscale-api-key>Headscale API Key</a></li><li><a href=#setup-headscale-cli>Setup Headscale CLI</a></li><li><a href=#membuat-user>Membuat User</a></li><li><a href=#menambahkan-node>Menambahkan Node</a><ul><li><a href=#method-1-pre-authorization-key-preauthkey---nodes-persisten>Method 1: Pre-Authorization Key (Preauthkey) - Nodes Persisten</a><ul><li><a href=#membuat-preauthkey>Membuat Preauthkey</a></li><li><a href=#add-node-menggunakan-preauthkey-linuxubuntu>Add Node Menggunakan Preauthkey (Linux/Ubuntu)</a></li><li><a href=#add-node-menggunakan-preauthkey-windows>Add Node Menggunakan Preauthkey (Windows)</a></li></ul></li><li><a href=#method-2-oidc---nodes-ephemeral-dengan-expiration>Method 2: OIDC - Nodes Ephemeral dengan Expiration</a><ul><li><a href=#add-node-menggunakan-oidc-linux>Add Node Menggunakan OIDC (Linux)</a></li><li><a href=#add-node-menggunakan-oidc-android>Add Node Menggunakan OIDC (Android)</a></li></ul></li><li><a href=#verifikasi-nodes>Verifikasi Nodes</a></li></ul></li><li><a href=#exit-node-dan-subnet-routes>Exit Node dan Subnet Routes</a><ul><li><a href=#exit-node>Exit Node</a><ul><li><a href=#use-case-exit-node>Use Case Exit Node</a></li><li><a href=#promote-node-sebagai-exit-node>Promote Node sebagai Exit Node</a></li><li><a href=#menggunakan-exit-node-dari-klien>Menggunakan Exit Node dari Klien</a></li></ul></li><li><a href=#subnet-routes>Subnet Routes</a><ul><li><a href=#use-case-subnet-routes>Use Case Subnet Routes</a></li><li><a href=#promote-node-sebagai-subnet-route>Promote Node sebagai Subnet Route</a></li><li><a href=#mengakses-resources-via-subnet-routes>Mengakses Resources via Subnet Routes</a></li></ul></li></ul></li></ul></li><li><a href=#testing-jaringan-headscale-mesh>Testing Jaringan Headscale Mesh</a><ul><li><a href=#verifikasi-node-connectivity>Verifikasi Node Connectivity</a><ul><li><a href=#ping-antar-nodes>Ping antar Nodes</a></li><li><a href=#check-connectivity-status-via-cli>Check Connectivity Status via CLI</a></li></ul></li><li><a href=#test-direct-communication>Test Direct Communication</a><ul><li><a href=#ssh-antar-nodes>SSH antar Nodes</a></li><li><a href=#file-transfer>File Transfer</a></li></ul></li><li><a href=#test-exit-node>Test Exit Node</a></li><li><a href=#test-subnet-routes>Test Subnet Routes</a></li><li><a href=#monitor-network-performance>Monitor Network Performance</a><ul><li><a href=#check-latency-dan-packet-loss>Check Latency dan Packet Loss</a></li><li><a href=#monitor-headscale-metrics>Monitor Headscale Metrics</a></li></ul></li><li><a href=#check-node-routes-dan-policies>Check Node Routes dan Policies</a></li><li><a href=#test-dari-different-os>Test dari Different OS</a></li><li><a href=#long-running-stability-test>Long-running Stability Test</a></li></ul></li><li><a href=#headplane>Headplane</a><ul><li><a href=#akses-headplane-web-interface>Akses Headplane Web Interface</a></li><li><a href=#login-ke-headplane>Login ke Headplane</a><ul><li><a href=#login-via-oidc-recommended>Login via OIDC (Recommended)</a></li><li><a href=#login-via-api-key>Login via API Key</a></li></ul></li></ul></li><li><a href=#summary>Summary</a></li><li><a href=#references>References</a></li></ul></nav></div></div><div class=content id=content><p>Ketika membangun infrastruktur yang terdistribusi, kebutuhan akan konektivitas yang aman, fleksibel, dan terpercaya menjadi prioritas utama. Headscale hadir sebagai solusi self-hosted yang memberikan kebebasan penuh untuk mengelola jaringan mesh private kita sendiri. Berbeda dengan Tailscale yang mengandalkan server terpusat milik vendor, Headscale memungkinkan kita untuk memiliki kontrol penuh, manajemen identitas, dan konfigurasi jaringan. Dalam artikel ini, kita akan mengeksplorasi bagaimana cara mengimplementasikan Headscale lengkap dengan Headplane sebagai web interface, sehingga kita dapat membangun ekosistem zero-trust networking yang aman dan efisien. Implementasi yang akan kita bahas mencakup instalasi di atas container (Docker Compose), konfigurasi SSL/TLS (dengan Caddy), integrasi OIDC (Google ID) untuk autentikasi yang robust, serta praktik operasional untuk mengelola nodes, routes, dan exit nodes. Dengan pendekatan hands-on, kita akan memahami setiap aspek teknis dari Headscale dan bagaimana menerapkannya di environment produksi.</p><h2 id=zero-trust-mesh-network>Zero Trust Mesh Network</h2><p><figure><a class=lightgallery href=/headscale-self-hosted-alternatif-tailscale/mesh-concept.png title="Mesh Network Concept" data-thumbnail=/headscale-self-hosted-alternatif-tailscale/mesh-concept.png data-sub-html="<h2>Mesh Network Concept</h2><p>Mesh Network Concept</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/headscale-self-hosted-alternatif-tailscale/mesh-concept.png data-srcset="/headscale-self-hosted-alternatif-tailscale/mesh-concept.png, /headscale-self-hosted-alternatif-tailscale/mesh-concept.png 1.5x, /headscale-self-hosted-alternatif-tailscale/mesh-concept.png 2x" data-sizes=auto alt=/headscale-self-hosted-alternatif-tailscale/mesh-concept.png width=1536 height=895></a><figcaption class=image-caption>Mesh Network Concept</figcaption></figure></p><p>Zero trust networking adalah paradigma keamanan modern yang mengubah cara kita merancang infrastruktur jaringan. Berbeda dengan model tradisional yang membangun perimeter keamanan di sekitar jaringan internal, zero trust mengimplementasikan prinsip &ldquo;never trust, always verify&rdquo; untuk setiap komunikasi, baik dari internal maupun eksternal.</p><h3 id=mesh-network-architecture>Mesh Network Architecture</h3><p>Mesh network adalah topologi jaringan di mana setiap node dapat berkomunikasi langsung dengan node lain tanpa harus melalui satu titik pusat (central hub). Dalam konteks zero trust, mesh network memungkinkan:</p><ul><li><strong>Direct Communication</strong>: Setiap perangkat dapat terhubung langsung dengan perangkat lain, mengeliminasi kebutuhan akan VPN concentrator tradisional.</li><li><strong>Distributed Resilience</strong>: Jika satu node offline, node lain tetap dapat berkomunikasi melalui rute alternatif.</li><li><strong>End-to-End Encryption</strong>: Semua komunikasi dienkripsi menggunakan WireGuard protocol, menjamin keamanan data dalam transit.</li><li><strong>Automatic Network Discovery</strong>: Nodes secara otomatis menemukan satu sama lain melalui control plane tanpa konfigurasi manual yang kompleks.</li></ul><h3 id=headscale-dan-tailscale>Headscale dan Tailscale</h3><p><strong>Tailscale</strong> adalah solusi VPN mesh network komersial yang dibangun di atas protokol WireGuard. Tailscale menyediakan layanan managed dengan server kontrol terpusat milik Tailscale Inc. Keuntungannya adalah kemudahan instalasi dan management, namun dengan trade-off: kita harus mempercayai Tailscale dengan metadata jaringan kita.</p><p><strong>Headscale</strong> adalah implementasi open-source dari Tailscale yang memungkinkan kita untuk menjalankan control plane sendiri. Headscale kompatibel dengan klien Tailscale, artinya kita dapat menggunakan aplikasi klien Tailscale yang sudah familiar sambil menjalankan server kontrol milik sendiri. Ini memberikan keuntungan:</p><ul><li><strong>Full Control</strong>: kita memiliki kontrol penuh atas data dan konfigurasi jaringan.</li><li><strong>Cost Efficient</strong>: Tidak perlu berlangganan layanan managed.</li><li><strong>Open Source</strong>: Kode tersedia untuk audit dan customization.</li><li><strong>Client Compatibility</strong>: Gunakan klien Tailscale resmi tanpa modifikasi.</li></ul><hr><h2 id=arsitektur>Arsitektur</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌─────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│         Internet / OIDC Provider        │
</span></span><span class=line><span class=cl>└───────────────────┬─────────────────────┘
</span></span><span class=line><span class=cl>                    ▼
</span></span><span class=line><span class=cl>                    │
</span></span><span class=line><span class=cl>         ┌──────────────────────┐
</span></span><span class=line><span class=cl>         │      Caddy (Proxy)   │
</span></span><span class=line><span class=cl>         └──┬────────────────┬──┘
</span></span><span class=line><span class=cl>            │                │
</span></span><span class=line><span class=cl>            ▼                ▼
</span></span><span class=line><span class=cl>     ┌────────────┐    ┌──────────────┐
</span></span><span class=line><span class=cl>     │ Headscale  │    │  Headplane   │
</span></span><span class=line><span class=cl>     │   (API)    │    │   (WebUI)    │
</span></span><span class=line><span class=cl>     └────┬───────┘    └──────┬───────┘
</span></span><span class=line><span class=cl>          │                   │
</span></span><span class=line><span class=cl>          │ (gRPC)            │ (REST/API)
</span></span><span class=line><span class=cl>          │                   │
</span></span><span class=line><span class=cl>          ▼                   ▼
</span></span><span class=line><span class=cl>     ┌──────────────────────────────┐
</span></span><span class=line><span class=cl>     │       SQLite Database        │
</span></span><span class=line><span class=cl>     │    (Users, Nodes, Routes)    │
</span></span><span class=line><span class=cl>     └──────────────────────────────┘
</span></span><span class=line><span class=cl>                    ▲
</span></span><span class=line><span class=cl>                    │
</span></span><span class=line><span class=cl>                    ▼
</span></span><span class=line><span class=cl>             ┌──────────────┐
</span></span><span class=line><span class=cl>             │   Tailscale  │
</span></span><span class=line><span class=cl>             │   Clients    │
</span></span><span class=line><span class=cl>             └──────────────┘
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=prerequisites>Prerequisites</h2><p>Sebelum memulai implementasi Headscale, pastikan beberapa prasyarat berikut terpenuhi.</p><ol><li>Docker dan Docker Compose sudah terinstall.</li><li>Akses <code>sudo</code> untuk menjalankan commands administratif.</li><li>FQDN yang valid untuk server Headscale (contoh: <code>headscale.deployer.dpdns.org</code>). A Record atau CNAME record yang mengarah ke IP server Headscale. DNS propagation sudah selesai dan resolving dengan benar. Dalam artikel ini saya menggunakan Cloudflare untuk DNS Management.</li></ol><p><figure><a class=lightgallery href=/headscale-self-hosted-alternatif-tailscale/cloudflare-dns-management.png title="Cloudflare DNS Management" data-thumbnail=/headscale-self-hosted-alternatif-tailscale/cloudflare-dns-management.png data-sub-html="<h2>Cloudflare DNS Management</h2><p>Cloudflare DNS Management</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/headscale-self-hosted-alternatif-tailscale/cloudflare-dns-management.png data-srcset="/headscale-self-hosted-alternatif-tailscale/cloudflare-dns-management.png, /headscale-self-hosted-alternatif-tailscale/cloudflare-dns-management.png 1.5x, /headscale-self-hosted-alternatif-tailscale/cloudflare-dns-management.png 2x" data-sizes=auto alt=/headscale-self-hosted-alternatif-tailscale/cloudflare-dns-management.png width=1924 height=578></a><figcaption class=image-caption>Cloudflare DNS Management</figcaption></figure></p><ol start=4><li>OIDC provider seperti Google, Keycloak, Okta, atau penyedia OIDC lainnya. Dalam artikel ini saya menggunakan Google. Siapkan credentials OIDC (Client ID dan Client Secret) yang akan diintegrasikan dengan Headscale. Contoh redirect URI yang sesuai: <code>https://&lt;FQDN-HEADSCALE>/oidc/callback</code> untuk Headscale dan <code>https://&lt;FQDN-HEADSCALE>/admin/oidc/callback</code> untuk Headplane.</li></ol><p><figure><a class=lightgallery href=/headscale-self-hosted-alternatif-tailscale/google-oidc.png title="OIDC Provider" data-thumbnail=/headscale-self-hosted-alternatif-tailscale/google-oidc.png data-sub-html="<h2>Dibuat lewat Google Cloud Console</h2><p>OIDC Provider</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/headscale-self-hosted-alternatif-tailscale/google-oidc.png data-srcset="/headscale-self-hosted-alternatif-tailscale/google-oidc.png, /headscale-self-hosted-alternatif-tailscale/google-oidc.png 1.5x, /headscale-self-hosted-alternatif-tailscale/google-oidc.png 2x" data-sizes=auto alt=/headscale-self-hosted-alternatif-tailscale/google-oidc.png width=2559 height=1372></a><figcaption class=image-caption>Dibuat lewat Google Cloud Console</figcaption></figure></p><hr><h2 id=instalasi--konfigurasi-headscale>Instalasi & Konfigurasi Headscale</h2><p>Pada bagian ini, kita akan mengimplementasikan Headscale beserta Headplane dalam environment Docker dengan SSL/TLS yang proper dan integrasi OIDC.</p><h3 id=struktur-direktori>Struktur Direktori</h3><p>Buat struktur direktori untuk Headscale dan konfigurasinya:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir -p /opt/docker/headscale/<span class=o>{</span>config/certificates,lib,run,headplane/config,headplane/data,secrets<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> /opt/docker/headscale
</span></span></code></pre></td></tr></table></div></div><h3 id=docker-secrets>Docker Secrets</h3><p>Buat file secrets yang akan digunakan oleh Docker Secrets feature:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Generate random secrets</span>
</span></span><span class=line><span class=cl>openssl rand -hex <span class=m>20</span> &gt; secrets/headplane_server_cookie_secret
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;&lt;OIDC_CLIENT_SECRET&gt;&#34;</span> &gt; secrets/oidc_client_secret
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Set proper permissions</span>
</span></span><span class=line><span class=cl>chmod <span class=m>600</span> secrets/*
</span></span></code></pre></td></tr></table></div></div><p>Ganti <code>&lt;OIDC_CLIENT_SECRET></code> dengan Client Secret dari OIDC provider kita.</p><h3 id=environment-file>Environment File</h3><p>Buat file <code>.env</code> untuk Docker Compose:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat &gt; /opt/docker/headscale/.env <span class=s>&lt;&lt; &#39;EOF&#39;
</span></span></span><span class=line><span class=cl><span class=s>TZ=Asia/Jakarta
</span></span></span><span class=line><span class=cl><span class=s>HEADPLANE_LOAD_ENV_OVERRIDES=true
</span></span></span><span class=line><span class=cl><span class=s>OIDC_CLIENT_ID=&lt;OIDC_CLIENT_ID&gt;
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></td></tr></table></div></div><p>Ganti <code>&lt;OIDC_CLIENT_ID></code> dengan Client ID dari OIDC provider kita.</p><h3 id=docker-compose-configuration>Docker Compose Configuration</h3><p>Buat <code>docker-compose.yaml</code> untuk Headscale dan Headplane:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>headscale</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>headscale</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>headscale/headscale:0.26.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>net1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;serve&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>unless-stopped</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>me.tale.headplane.target</span><span class=p>:</span><span class=w> </span><span class=l>headscale</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>50443</span><span class=p>:</span><span class=m>50443</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./config:/etc/headscale/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./lib:/var/lib/headscale/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./run:/var/run/headscale/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>secrets</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>oidc_client_secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>TZ=${TZ}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>headplane</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>ghcr.io/tale/headplane:0.6.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>headplane</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>net1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=p>:</span><span class=m>3002</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>secrets</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>headplane_server_cookie_secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>oidc_client_secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>headscale_api_key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>TZ=${TZ}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>HEADPLANE_LOAD_ENV_OVERRIDES=${HEADPLANE_LOAD_ENV_OVERRIDES}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>HEADPLANE_OIDC__CLIENT_ID=${OIDC_CLIENT_ID}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./headplane/config/config.yaml:/etc/headplane/config.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./headplane/data:/var/lib/headplane</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./config/config.yaml:/etc/headscale/config.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/var/run/docker.sock:/var/run/docker.sock:ro</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>headscale</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>secrets</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>headscale_api_key</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>file</span><span class=p>:</span><span class=w> </span><span class=l>./secrets/headscale_api_key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>headplane_server_cookie_secret</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>file</span><span class=p>:</span><span class=w> </span><span class=l>./secrets/headplane_server_cookie_secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>oidc_client_secret</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>file</span><span class=p>:</span><span class=w> </span><span class=l>./secrets/oidc_client_secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>net1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>net1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>external</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=konfigurasi-headscale>Konfigurasi Headscale</h3><p>Buat file <code>/opt/docker/headscale/config/config.yaml</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>server_url</span><span class=p>:</span><span class=w> </span><span class=l>https://headscale.deployer.dpdns.org</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>listen_addr</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metrics_listen_addr</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>9090</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>grpc_listen_addr</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>50443</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>grpc_allow_insecure</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>noise</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>private_key_path</span><span class=p>:</span><span class=w> </span><span class=l>/etc/headscale/noise_private.key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>prefixes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>v4</span><span class=p>:</span><span class=w> </span><span class=m>100.64.0.0</span><span class=l>/10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>derp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>server</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>urls</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>https://controlplane.tailscale.com/derpmap/default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>paths</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>auto_update_enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>update_frequency</span><span class=p>:</span><span class=w> </span><span class=l>3h</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>disable_check_updates</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>ephemeral_node_inactivity_timeout</span><span class=p>:</span><span class=w> </span><span class=l>30m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>database</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>sqlite</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>gorm</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>prepare_stmt</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>parameterized_queries</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>skip_err_record_not_found</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>slow_threshold</span><span class=p>:</span><span class=w> </span><span class=m>1000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>sqlite</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/var/lib/headscale/db.sqlite</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>write_ahead_log</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>wal_autocheckpoint</span><span class=p>:</span><span class=w> </span><span class=m>1000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>acme_url</span><span class=p>:</span><span class=w> </span><span class=l>https://acme-v02.api.letsencrypt.org/directory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>acme_email</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;trianwar@protonmail.com&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tls_letsencrypt_hostname</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tls_letsencrypt_cache_dir</span><span class=p>:</span><span class=w> </span><span class=l>/var/lib/headscale/cache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tls_letsencrypt_challenge_type</span><span class=p>:</span><span class=w> </span><span class=l>HTTP-01</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tls_letsencrypt_listen</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;:http&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tls_cert_path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/etc/headscale/certificates/headscale.deployer.dpdns.org.crt&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tls_key_path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/etc/headscale/certificates/headscale.deployer.dpdns.org.key&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>log</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=l>info</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>format</span><span class=p>:</span><span class=w> </span><span class=l>text</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>policy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>dns</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>magic_dns</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>base_domain</span><span class=p>:</span><span class=w> </span><span class=l>hs.deployer.dpdns.org</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>override_local_dns</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameservers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>global</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>1.1.1.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>1.0.0.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>45.90.28.93</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>45.90.30.93</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>split</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>search_domains</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extra_records</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>unix_socket</span><span class=p>:</span><span class=w> </span><span class=l>/var/run/headscale/headscale.sock</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>unix_socket_permission</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0770&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>oidc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>only_start_if_oidc_is_available</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>issuer</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https://accounts.google.com&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>client_id</span><span class=p>:</span><span class=w> </span><span class=l>&lt;OIDC_CLIENT_ID&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>client_secret_path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/run/secrets/oidc_client_secret&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>scope</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;openid&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;profile&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;email&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>allowed_domains</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>deployer.dpdns.org</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>headscale.deployer.dpdns.org</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>hs.deployer.dpdns.org</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>gmail.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>allowed_users</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>adminheadscale@gmail.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pkce</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>method</span><span class=p>:</span><span class=w> </span><span class=l>S256</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>logtail</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>randomize_client_port</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=konfigurasi-headplane>Konfigurasi Headplane</h3><p>Buat file <code>/opt/docker/headscale/headplane/config/config.yaml</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>server</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.0.0.0&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>3002</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cookie_secret_path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/run/secrets/headplane_server_cookie_secret&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cookie_secure</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cookie_max_age</span><span class=p>:</span><span class=w> </span><span class=m>86400</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>data_path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/var/lib/headplane&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>headscale</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https://headscale.deployer.dpdns.org&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config_path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/etc/headscale/config.yaml&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config_strict</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>integration</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>agent</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>docker</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_label</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;me.tale.headplane.target=headscale&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;headscale&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>socket</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;unix:///var/run/docker.sock&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kubernetes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>validate_manifest</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pod_name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;headscale&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>proc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>oidc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>issuer</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https://accounts.google.com&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>client_id</span><span class=p>:</span><span class=w> </span><span class=l>$HEADPLANE_OIDC__CLIENT_ID</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>client_secret_path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/run/secrets/oidc_client_secret&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>disable_api_key_login</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>token_endpoint_auth_method</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;client_secret_post&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>headscale_api_key_path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/run/secrets/headscale_api_key&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>redirect_uri</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https://headscale.deployer.dpdns.org/admin/oidc/callback&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><hr><h2 id=caddy>Caddy</h2><p>Dalam artikel ini kita menggunakan Caddy untuk reverse proxy sesuai diagram arsitektur di atas.</p><h3 id=docker-compose-configuration-1>Docker Compose Configuration</h3><p>Buat <code>docker-compose.yml</code> untuk Caddy di <code>/opt/docker/caddy/docker-compose.yml</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>caddy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>net1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>caddy:alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>caddy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>unless-stopped</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>80</span><span class=p>:</span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>443</span><span class=p>:</span><span class=m>443</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./caddy_data:/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./caddy_config:/config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./Caddyfile:/etc/caddy/Caddyfile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>net1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>net1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>external</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=caddyfile-configuration>Caddyfile Configuration</h3><p>Buat <code>Caddyfile</code> untuk routing:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>headscale.deployer.dpdns.org {
</span></span><span class=line><span class=cl>  reverse_proxy /admin* headplane:3002
</span></span><span class=line><span class=cl>  reverse_proxy * {
</span></span><span class=line><span class=cl>    to https://headscale:8080
</span></span><span class=line><span class=cl>    transport http {
</span></span><span class=line><span class=cl>      tls
</span></span><span class=line><span class=cl>      tls_insecure_skip_verify
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>Terkadang saya perlu menambahkan konfigurasi manual di <code>/etc/hosts</code> seperti berikut:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>127.0.0.1       localhost
</span></span><span class=line><span class=cl>213.35.123.24   headscale.deployer.dpdns.org ubuntu1.oci.deployer.dpdns.org
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=deployment>Deployment</h2><p>Buat network Docker terlebih dahulu:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker network create net1
</span></span></code></pre></td></tr></table></div></div><p>Start Caddy:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /opt/docker/caddy
</span></span><span class=line><span class=cl>docker compose -p caddy up -d
</span></span></code></pre></td></tr></table></div></div><p>Start Headscale dan Headplane:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /opt/docker/headscale
</span></span><span class=line><span class=cl>docker compose -p headscale up -d
</span></span></code></pre></td></tr></table></div></div><h3 id=verify-installation>Verify Installation</h3><p>Cek status containers:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker ps
</span></span></code></pre></td></tr></table></div></div><p>Cek logs untuk memastikan tidak ada error:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker logs headscale
</span></span><span class=line><span class=cl>docker logs headplane
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=headscale-administration>Headscale Administration</h2><h3 id=headscale-api-key>Headscale API Key</h3><p>Selanjutnya kita akan membuat API Key Headscale untuk keperluan administrasi, misalnya saya menggunakan <code>--expiration 999d</code> untuk jangka panjang:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker <span class=nb>exec</span> -it headscale headscale apikeys create --expiration 999d
</span></span></code></pre></td></tr></table></div></div><p>Catat dam simpan API Key ini, serta masukkan ke dalam Docker Secrets:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;&lt;HEADSCALE_API_KEY&gt;&#34;</span> &gt; /opt/docker/headscale/secrets/headscale_api_key
</span></span><span class=line><span class=cl>chmod <span class=m>600</span> /opt/docker/headscale/secrets/headscale_api_key
</span></span></code></pre></td></tr></table></div></div><h3 id=setup-headscale-cli>Setup Headscale CLI</h3><p>Sebelum menjalankan perintah Headscale, setup environment variables untuk CLI:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>HEADSCALE_CLI_ADDRESS</span><span class=o>=</span><span class=s2>&#34;headscale.deployer.dpdns.org:50443&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>HEADSCALE_CLI_API_KEY</span><span class=o>=</span><span class=k>$(</span>cat /opt/docker/headscale/secrets/headscale_api_key<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>HEADSCALE_CLI_INSECURE</span><span class=o>=</span><span class=m>0</span>
</span></span></code></pre></td></tr></table></div></div><p>Atau tambahkan ke <code>~/.bashrc</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;export HEADSCALE_CLI_ADDRESS=&#34;headscale.deployer.dpdns.org:50443&#34;&#39;</span> &gt;&gt; ~/.bashrc
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;export HEADSCALE_CLI_API_KEY=&lt;HEADSCALE_API_KEY&gt;&#39;</span> &gt;&gt; ~/.bashrc
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;export HEADSCALE_CLI_INSECURE=0&#39;</span> &gt;&gt; ~/.bashrc
</span></span><span class=line><span class=cl><span class=nb>source</span> ~/.bashrc
</span></span></code></pre></td></tr></table></div></div><h3 id=membuat-user>Membuat User</h3><p>Setiap node harus tergabung dalam user. Buat user terlebih dahulu:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>headscale users create admin
</span></span></code></pre></td></tr></table></div></div><p>Verifikasi user yang sudah dibuat:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>headscale users list
</span></span></code></pre></td></tr></table></div></div><h3 id=menambahkan-node>Menambahkan Node</h3><p>Langkah selanjutnya adalah menambahkan perangkat (nodes) ke dalam jaringan. Headscale mendukung berbagai metode autentikasi: Pre-Authorization Key (Preauthkey), OIDC, dan ephemeral nodes.</p><h4 id=method-1-pre-authorization-key-preauthkey---nodes-persisten>Method 1: Pre-Authorization Key (Preauthkey) - Nodes Persisten</h4><p>Preauthkey adalah cara termudah untuk menambahkan nodes yang tidak menggunakan OIDC. Preauthkey dapat dibuat sebagai reusable (dapat digunakan berkali-kali) atau single-use (hanya sekali).</p><h5 id=membuat-preauthkey>Membuat Preauthkey</h5><p>Untuk menambahkan nodes yang tidak memiliki Expiration, gunakan preauthkey reusable:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>headscale preauthkeys create <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --user admin <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --reusable <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --expiration 999d
</span></span></code></pre></td></tr></table></div></div><p>Output akan menampilkan key, contoh: <code>eed8cce8d0c9e5bda3f5e8d5e8c9d5c6</code></p><p>Catat key ini untuk digunakan saat setup klien.</p><h5 id=add-node-menggunakan-preauthkey-linuxubuntu>Add Node Menggunakan Preauthkey (Linux/Ubuntu)</h5><p><strong>Install Tailscale Client</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Ubuntu/Debian</span>
</span></span><span class=line><span class=cl>curl -fsSL https://tailscale.com/install.sh <span class=p>|</span> sh
</span></span></code></pre></td></tr></table></div></div><p><strong>Connect ke Headscale</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo tailscale up <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --login-server https://headscale.deployer.dpdns.org <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --authkey eed8cce8d0c9e5bda3f5e8d5e8c9d5c6
</span></span></code></pre></td></tr></table></div></div><p>Ganti dengan IP yang sesuai untuk Ubuntu server. Verifikasi dari Headscale:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>headscale nodes list
</span></span></code></pre></td></tr></table></div></div><p>Nodes baru akan muncul dalam daftar dengan IP dari prefix <code>100.64.0.0/10</code>.</p><h5 id=add-node-menggunakan-preauthkey-windows>Add Node Menggunakan Preauthkey (Windows)</h5><p><strong>Install Tailscale Client</strong></p><p>Download dan install dari <a href=https://tailscale.com/download/windows target=_blank rel="noopener noreffer">https://tailscale.com/download/windows</a>. Gunakan stable version.</p><p><strong>Connect via Command Prompt (Admin)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl>C<span class=p>:</span><span class=nl>\Program</span><span class=c1> Files\Tailscale\tailscale.exe up ^</span>
</span></span><span class=line><span class=cl>  --login-server=https://headscale.deployer.dpdns.org <span class=se>^
</span></span></span><span class=line><span class=cl><span class=se> </span> --authkey=eed8cce8d0c9e5bda3f5e8d5e8c9d5c6
</span></span></code></pre></td></tr></table></div></div><p><strong>Atau Menggunakan GUI</strong></p><ol><li>Klik Tailscale icon di system tray</li><li>Klik &ldquo;Login&rdquo; atau &ldquo;Sign in&rdquo;</li><li>Pilih &ldquo;Use custom server&rdquo; atau lihat opsi &ldquo;Login Server&rdquo;</li><li>Masukkan URL Headscale: <code>https://headscale.deployer.dpdns.org</code></li><li>Paste preauthkey saat diminta</li><li>Tunggu hingga connected</li></ol><h4 id=method-2-oidc---nodes-ephemeral-dengan-expiration>Method 2: OIDC - Nodes Ephemeral dengan Expiration</h4><p>Nodes yang login menggunakan OIDC akan memiliki automatic expiration sesuai konfigurasi OIDC.</p><p><figure><a class=lightgallery href=/headscale-self-hosted-alternatif-tailscale/headscale-google-oidc-login.png title="Headscale Google OIDC Login" data-thumbnail=/headscale-self-hosted-alternatif-tailscale/headscale-google-oidc-login.png data-sub-html="<h2>Headscale Google OIDC Login</h2><p>Headscale Google OIDC Login</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/headscale-self-hosted-alternatif-tailscale/headscale-google-oidc-login.png data-srcset="/headscale-self-hosted-alternatif-tailscale/headscale-google-oidc-login.png, /headscale-self-hosted-alternatif-tailscale/headscale-google-oidc-login.png 1.5x, /headscale-self-hosted-alternatif-tailscale/headscale-google-oidc-login.png 2x" data-sizes=auto alt=/headscale-self-hosted-alternatif-tailscale/headscale-google-oidc-login.png width=1965 height=1280></a><figcaption class=image-caption>Headscale Google OIDC Login</figcaption></figure></p><h5 id=add-node-menggunakan-oidc-linux>Add Node Menggunakan OIDC (Linux)</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Install Tailscale</span>
</span></span><span class=line><span class=cl>curl -fsSL https://tailscale.com/install.sh <span class=p>|</span> sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Connect ke Headscale dengan OIDC</span>
</span></span><span class=line><span class=cl>sudo tailscale up <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --login-server https://headscale.deployer.dpdns.org
</span></span></code></pre></td></tr></table></div></div><p>Perintah ini akan membuka browser dengan OIDC login flow (Google OAuth dalam contoh ini). Setelah login berhasil, node akan secara otomatis ditambahkan ke user yang sesuai berdasarkan email OIDC. Jika berhasil akan muncul seperti berikut:</p><p><figure><a class=lightgallery href=/headscale-self-hosted-alternatif-tailscale/headscale-google-oidc-login-success.png title="Headscale Google OIDC Login Success" data-thumbnail=/headscale-self-hosted-alternatif-tailscale/headscale-google-oidc-login-success.png data-sub-html="<h2>Headscale Google OIDC Login Success</h2><p>Headscale Google OIDC Login Success</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/headscale-self-hosted-alternatif-tailscale/headscale-google-oidc-login-success.png data-srcset="/headscale-self-hosted-alternatif-tailscale/headscale-google-oidc-login-success.png, /headscale-self-hosted-alternatif-tailscale/headscale-google-oidc-login-success.png 1.5x, /headscale-self-hosted-alternatif-tailscale/headscale-google-oidc-login-success.png 2x" data-sizes=auto alt=/headscale-self-hosted-alternatif-tailscale/headscale-google-oidc-login-success.png width=1972 height=808></a><figcaption class=image-caption>Headscale Google OIDC Login Success</figcaption></figure></p><h5 id=add-node-menggunakan-oidc-android>Add Node Menggunakan OIDC (Android)</h5><ol><li>Unduh aplikasi &ldquo;Tailscale&rdquo; dari Google Play Store</li><li>Buka aplikasi</li><li>Tap &ldquo;Sign in&rdquo;</li><li>Pilih &ldquo;Use custom server&rdquo;</li><li>Masukkan URL: <code>https://headscale.deployer.dpdns.org</code></li><li>Lanjutkan dengan OIDC login (Google)</li><li>Approve akses, dan node akan terhubung otomatis</li></ol><p>Jika berhasil, akan tampil seperti berikut:</p><p><figure><a class=lightgallery href=/headscale-self-hosted-alternatif-tailscale/tailscale-android.png title="Tailscale Android" data-thumbnail=/headscale-self-hosted-alternatif-tailscale/tailscale-android.png data-sub-html="<h2>Tailscale Android</h2><p>Tailscale Android</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/headscale-self-hosted-alternatif-tailscale/tailscale-android.png data-srcset="/headscale-self-hosted-alternatif-tailscale/tailscale-android.png, /headscale-self-hosted-alternatif-tailscale/tailscale-android.png 1.5x, /headscale-self-hosted-alternatif-tailscale/tailscale-android.png 2x" data-sizes=auto alt=/headscale-self-hosted-alternatif-tailscale/tailscale-android.png width=1589 height=1044></a><figcaption class=image-caption>Tailscale Android</figcaption></figure></p><h4 id=verifikasi-nodes>Verifikasi Nodes</h4><p>Lihat semua nodes yang terhubung:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>headscale nodes list
</span></span></code></pre></td></tr></table></div></div><p>Output akan menampilkan:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ID | Hostname  | Name          | MachineKey | NodeKey | User     | IP addresses     | Ephemeral | Last seen           | Expiration          | Connected | Expired
</span></span><span class=line><span class=cl>1  | ubuntu1   | ubuntu1       | [01fm1]    | [mjpRt] | admin    | 100.64.0.1,      | false     | 2025-12-11 00:27:30 | N/A                 | online    | no
</span></span><span class=line><span class=cl>2  | sanctuary | sanctuary-w11 | [LdPRR]    | [6Yxkf] | anjaydev | 100.64.0.3,      | false     | 2025-12-11 01:08:19 | 2026-05-27 12:29:02 | online    | no
</span></span><span class=line><span class=cl>3  | armbian   | armbian       | [HG9T3]    | [81gjw] | admin    | 100.64.0.4,      | false     | 2025-12-11 00:48:36 | N/A                 | online    | no
</span></span><span class=line><span class=cl>4  | localhost | poco-f4       | [rfgMx]    | [+Z+vk] | anjaydev | 100.64.0.5,      | false     | 2025-12-11 00:28:31 | 2026-05-27 12:48:11 | online    | no
</span></span><span class=line><span class=cl>5  | fafafufu  | iphone        | [0U0To]    | [ojNsX] | anjaydev | 100.64.0.6,      | false     | 2025-12-11 00:48:27 | 2026-05-27 12:49:46 | online    | no
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=exit-node-dan-subnet-routes>Exit Node dan Subnet Routes</h3><p>Headscale mendukung dua tipe route promotion: Exit Node dan Subnet Routes. Kedua fitur ini memungkinkan traffic dari nodes lain untuk melalui node tertentu.</p><h4 id=exit-node>Exit Node</h4><p>Exit Node adalah node yang berperan sebagai gateway untuk seluruh traffic nodes lain. Semua traffic internet dari nodes yang menggunakan Exit Node akan diroute melalui Exit Node tersebut.</p><h5 id=use-case-exit-node>Use Case Exit Node</h5><ul><li>Memberikan akses internet dengan IP yang sama</li><li>Mengubah lokasi geografis traffic</li><li>Centralized traffic filtering dan monitoring</li><li>Backup connectivity jika node kehilangan akses internet langsung</li></ul><h5 id=promote-node-sebagai-exit-node>Promote Node sebagai Exit Node</h5><p>Dari daftar nodes di atas, <code>ubuntu1</code> dan <code>armbian</code> dilabelkan untuk exit node. Untuk promote node sebagai exit node:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Check current routes yang advertised oleh node</span>
</span></span><span class=line><span class=cl>headscale nodes list-routes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Untuk ubuntu1</span>
</span></span><span class=line><span class=cl>headscale routes <span class=nb>enable</span> --identifier <span class=m>1</span> --route 0.0.0.0/0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Untuk armbian</span>
</span></span><span class=line><span class=cl>headscale routes <span class=nb>enable</span> --identifier <span class=m>3</span> --route 0.0.0.0/0
</span></span></code></pre></td></tr></table></div></div><p>Setelah di-promote, nodes lain dapat memilih untuk menempatkan traffic mereka melalui exit node ini.</p><h5 id=menggunakan-exit-node-dari-klien>Menggunakan Exit Node dari Klien</h5><p><strong>Linux/macOS</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># List available exit nodes</span>
</span></span><span class=line><span class=cl>sudo tailscale exit-node list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Use specific exit node (by IP atau hostname)</span>
</span></span><span class=line><span class=cl>sudo tailscale <span class=nb>set</span> --exit-node<span class=o>=</span>100.64.0.1  <span class=c1># ubuntu1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Disable exit node</span>
</span></span><span class=line><span class=cl>sudo tailscale <span class=nb>set</span> --exit-node<span class=o>=</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Windows (via GUI)</strong></p><ol><li>Klik Tailscale icon di system tray</li><li>Settings → Exit node</li><li>Pilih node yang ingin digunakan</li><li>Traffic akan mulai diroute melalui exit node</li></ol><p><strong>Android/iOS</strong></p><ol><li>Buka aplikasi Tailscale</li><li>Settings / Gear icon</li><li>Pilih &ldquo;Exit nodes&rdquo; atau &ldquo;Route all traffic&rdquo;</li><li>Pilih exit node yang tersedia</li></ol><h4 id=subnet-routes>Subnet Routes</h4><p>Subnet Routes memungkinkan nodes untuk promote subnets tertentu sehingga nodes lain dapat mengakses resources di subnet tersebut. Berbeda dari exit node yang meroute semua traffic, subnet routes hanya meroute traffic untuk subnets spesifik.</p><h5 id=use-case-subnet-routes>Use Case Subnet Routes</h5><ul><li>Share local subnets dengan nodes lain dalam mesh (contoh: LAN lokal)</li><li>Access resources di private networks (contoh: internal servers, database)</li><li>Multi-location connectivity untuk distributed infrastructure</li><li>IoT devices discovery dan management</li></ul><h5 id=promote-node-sebagai-subnet-route>Promote Node sebagai Subnet Route</h5><p>Dari contoh nodes, <code>armbian</code> mempromote dua subnets: <code>192.168.200.0/24</code> dan <code>192.168.254.0/24</code>. Untuk promote subnets:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Pertama, verifikasi routes yang available di node</span>
</span></span><span class=line><span class=cl><span class=c1># Command ini biasanya dilakukan dari node itu sendiri</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Dari control plane, enable specific routes</span>
</span></span><span class=line><span class=cl>headscale routes <span class=nb>enable</span> --identifier <span class=m>3</span> --route 192.168.200.0/24
</span></span><span class=line><span class=cl>headscale routes <span class=nb>enable</span> --identifier <span class=m>3</span> --route 192.168.254.0/24
</span></span></code></pre></td></tr></table></div></div><p>Dari output <code>headscale nodes list-routes</code>, terlihat bahwa <code>armbian</code> (ID 3) mempromote:</p><ul><li><strong>Approved & Available</strong>: <code>192.168.200.0/24</code>, <code>192.168.254.0/24</code></li><li><strong>Serving (Primary)</strong>: <code>192.168.200.0/24</code>, <code>192.168.254.0/24</code></li></ul><p>Ini berarti perangkat lain dalam mesh dapat mengakses resources di kedua subnet tersebut melalui node <code>armbian</code>.</p><h5 id=mengakses-resources-via-subnet-routes>Mengakses Resources via Subnet Routes</h5><p>Setelah subnet routes di-enable, nodes lain dapat secara otomatis mengakses resources di subnets tersebut menggunakan IP address lokal:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Dari node lain dalam mesh, ping resource di promoted subnet</span>
</span></span><span class=line><span class=cl>ping 192.168.200.5
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Atau SSH ke resources</span>
</span></span><span class=line><span class=cl>ssh user@192.168.254.10
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Atau akses HTTP service</span>
</span></span><span class=line><span class=cl>curl http://192.168.200.20:8080
</span></span></code></pre></td></tr></table></div></div><p>Klien Headscale secara otomatis mengupdate routing table untuk mengarahkan traffic ke subnet ke exit node yang appropriate. Tapi pada klien CLI, bisa jadi kita perlu menambahkan <code>--accept-routes</code> dengan perintah berikut:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo tailscale <span class=nb>set</span> --accept-routes
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=testing-jaringan-headscale-mesh>Testing Jaringan Headscale Mesh</h2><p>Setelah semua nodes terhubung dan routes dikonfigurasi, langkah berikutnya adalah verifikasi bahwa jaringan mesh berfungsi dengan baik.</p><h3 id=verifikasi-node-connectivity>Verifikasi Node Connectivity</h3><h4 id=ping-antar-nodes>Ping antar Nodes</h4><p>Dari node manapun dalam mesh, test ping ke node lain menggunakan IP Headscale mereka:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Dari ubuntu1 (100.64.0.1), ping ke sanctuary (100.64.0.3)</span>
</span></span><span class=line><span class=cl>ping 100.64.0.3
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Dari sanctuary, ping ke armbian (100.64.0.4)</span>
</span></span><span class=line><span class=cl>ping 100.64.0.4
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Dari armbian, ping ke poco-f4 (100.64.0.5)</span>
</span></span><span class=line><span class=cl>ping 100.64.0.5
</span></span></code></pre></td></tr></table></div></div><p>Expected output: packets diterima dengan latency yang reasonable (tergantung network path).</p><h4 id=check-connectivity-status-via-cli>Check Connectivity Status via CLI</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># List nodes dengan status koneksi</span>
</span></span><span class=line><span class=cl>headscale nodes list --output json <span class=p>|</span> jq <span class=s1>&#39;.nodes[] | {name: .name, ip: .ipaddresses, connected: .online}&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=test-direct-communication>Test Direct Communication</h3><h4 id=ssh-antar-nodes>SSH antar Nodes</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Setup SSH pada nodes terlebih dahulu</span>
</span></span><span class=line><span class=cl><span class=c1># Pada node target, pastikan SSH daemon running</span>
</span></span><span class=line><span class=cl>sudo systemctl status ssh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Dari node lain, SSH ke node target menggunakan Tailscale IP</span>
</span></span><span class=line><span class=cl>ssh user@100.64.0.4  <span class=c1># Connect ke armbian</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Verifikasi tracer</span>
</span></span><span class=line><span class=cl>traceroute 100.64.0.4
</span></span></code></pre></td></tr></table></div></div><h4 id=file-transfer>File Transfer</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Menggunakan scp untuk transfer file via Tailscale network</span>
</span></span><span class=line><span class=cl>scp file.txt user@100.64.0.5:/tmp/
</span></span><span class=line><span class=cl>scp -r user@100.64.0.3:/home/user/documents ~/downloads/
</span></span></code></pre></td></tr></table></div></div><h3 id=test-exit-node>Test Exit Node</h3><p>Jika exit nodes sudah di-configure:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Dari node yang menggunakan exit node</span>
</span></span><span class=line><span class=cl>curl https://ipinfo.io/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># IP address yang dikembalikan harus adalah IP dari exit node server</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=test-subnet-routes>Test Subnet Routes</h3><p>Jika subnet routes sudah di-promote:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Dari node dalam mesh, access resource di promoted subnet</span>
</span></span><span class=line><span class=cl>ping 192.168.200.1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Traceroute untuk verify routing path</span>
</span></span><span class=line><span class=cl>traceroute 192.168.200.1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Test aplikasi di subnet (web server, database, dll)</span>
</span></span><span class=line><span class=cl>curl http://192.168.200.50:8080
</span></span><span class=line><span class=cl>telnet 192.168.254.5 <span class=m>5432</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=monitor-network-performance>Monitor Network Performance</h3><h4 id=check-latency-dan-packet-loss>Check Latency dan Packet Loss</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Gunakan mtr untuk monitoring latency dan packet loss</span>
</span></span><span class=line><span class=cl>mtr 100.64.0.3
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Atau ping dengan statistik</span>
</span></span><span class=line><span class=cl>ping -c <span class=m>10</span> 100.64.0.4
</span></span></code></pre></td></tr></table></div></div><h4 id=monitor-headscale-metrics>Monitor Headscale Metrics</h4><p>Headscale expose Prometheus metrics di port 9090:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Query metrics</span>
</span></span><span class=line><span class=cl>curl http://localhost:9090/metrics
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Lihat metrik yang relevan</span>
</span></span><span class=line><span class=cl>curl http://localhost:9090/metrics <span class=p>|</span> grep headscale
</span></span></code></pre></td></tr></table></div></div><h3 id=check-node-routes-dan-policies>Check Node Routes dan Policies</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># List routes dengan details</span>
</span></span><span class=line><span class=cl>headscale nodes list-routes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Check ACL/Policy jika menggunakan policy file</span>
</span></span><span class=line><span class=cl>headscale policy view
</span></span></code></pre></td></tr></table></div></div><h3 id=test-dari-different-os>Test dari Different OS</h3><p>Untuk memastikan compatibility di berbagai OS, test dari:</p><ul><li><strong>Linux desktop</strong> (Ubuntu, Fedora)</li><li><strong>Windows</strong> (desktop atau server)</li><li><strong>macOS</strong> (Intel atau Apple Silicon)</li><li><strong>Mobile</strong> (Android, iOS)</li><li><strong>ARM devices</strong> (Raspberry Pi, Armbian)</li></ul><h3 id=long-running-stability-test>Long-running Stability Test</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Ping continuous untuk 24 jam dan monitor stability</span>
</span></span><span class=line><span class=cl>ping 100.64.0.3 &gt; ping_results.txt <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Monitor disk usage dan memory pada headscale container</span>
</span></span><span class=line><span class=cl>docker stats headscale --no-stream
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Check logs untuk error atau warnings</span>
</span></span><span class=line><span class=cl>docker logs headscale <span class=p>|</span> tail -100
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=headplane>Headplane</h2><p>Headplane adalah web-based management interface untuk Headscale yang memudahkan administrasi jaringan melalui GUI daripada command-line interface. Headplane bertindak sebagai <strong>control plane user interface</strong> yang menyederhanakan manajemen Headscale.</p><p><figure><a class=lightgallery href=/headscale-self-hosted-alternatif-tailscale/headplane-machines-list.png title="Headplane Machines List" data-thumbnail=/headscale-self-hosted-alternatif-tailscale/headplane-machines-list.png data-sub-html="<h2>Headplane Machines List</h2><p>Headplane Machines List</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/headscale-self-hosted-alternatif-tailscale/headplane-machines-list.png data-srcset="/headscale-self-hosted-alternatif-tailscale/headplane-machines-list.png, /headscale-self-hosted-alternatif-tailscale/headplane-machines-list.png 1.5x, /headscale-self-hosted-alternatif-tailscale/headplane-machines-list.png 2x" data-sizes=auto alt=/headscale-self-hosted-alternatif-tailscale/headplane-machines-list.png width=2119 height=975></a><figcaption class=image-caption>Headplane Machines List</figcaption></figure></p><p><strong>Peran utama Headplane:</strong></p><ul><li>User authentication via OIDC</li><li>Node management (view, approve, remove nodes)</li><li>Route management (enable/disable routes)</li><li>API key management</li><li>Monitoring dashboard</li><li>Integration dengan Docker containers</li></ul><h3 id=akses-headplane-web-interface>Akses Headplane Web Interface</h3><p>Headplane dapat diakses melalui URL:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>https://headscale.deployer.dpdns.org/admin
</span></span></code></pre></td></tr></table></div></div><h3 id=login-ke-headplane>Login ke Headplane</h3><h4 id=login-via-oidc-recommended>Login via OIDC (Recommended)</h4><ol><li>Buka <code>https://headscale.deployer.dpdns.org/admin</code></li><li>Klik &ldquo;Sign in with OIDC&rdquo; atau &ldquo;Google&rdquo; button</li><li>Lakukan Google OAuth flow</li><li>Setelah approved, akan redirect ke Headplane dashboard</li><li>Session akan aktif untuk durasi yang dikonfigurasi (default: 24 jam)</li></ol><h4 id=login-via-api-key>Login via API Key</h4><p>Jika OIDC tidak tersedia atau untuk akses programmatic:</p><ol><li>Dapatkan API key dari <code>/run/secrets/headscale_api_key</code></li><li>Pada login screen, masukkan API key sebagai credentials</li><li>Sistem akan validate key dan grant access</li></ol><hr><h2 id=summary>Summary</h2><p>Headscale memberikan alternatif yang powerful untuk Tailscale dengan memberikan kontrol penuh atas mesh network kita sendiri. Dengan implementasi yang telah dibahas dalam artikel ini, kita telah membangun infrastruktur yang:</p><ul><li><strong>Secure</strong>: End-to-end encryption dengan WireGuard, authentication via OIDC</li><li><strong>Scalable</strong>: Support multiple nodes dari berbagai OS, dan database teroptimasi</li><li><strong>Manageable</strong>: Web interface via Headplane, kontrol penuh dari CLI</li><li><strong>Flexible</strong>: Custom routing, exit nodes, subnet routes</li><li><strong>Resilient</strong>: Distributed mesh architecture dengan redundancy</li></ul><p>Implementasi Headscale cocok untuk berbagai use case:</p><ul><li><strong>Remote Work</strong>: Secure access ke corporate resources</li><li><strong>Distributed Teams</strong>: Mesh connectivity antar lokasi yang berbeda</li><li><strong>IoT Management</strong>: Pengelolaan terpusat untuk IoT devices</li><li><strong>Hybrid Cloud</strong>: Seamless connectivity di multi-cloud environment</li><li><strong>Privacy-focused</strong>: Kontrol penuh tanpa ketergantungan pada third-party</li></ul><p>Dengan monitoring, best practices, dan regular maintenance, Headscale dapat berjalan stabil dalam production environment dengan jumlah nodes dan user yang massif.</p><hr><h2 id=references>References</h2><ul><li><a href=https://headscale.net/ target=_blank rel="noopener noreffer">https://headscale.net/</a></li><li><a href=https://github.com/tale/headplane target=_blank rel="noopener noreffer">https://github.com/tale/headplane</a></li><li><a href=https://tailscale.com/kb/1133/tailscale-architecture/ target=_blank rel="noopener noreffer">https://tailscale.com/kb/1133/tailscale-architecture/</a></li><li><a href=https://www.wireguard.com/ target=_blank rel="noopener noreffer">https://www.wireguard.com/</a></li><li><a href=https://www.cloudflare.com/learning/security/glossary/what-is-zero-trust/ target=_blank rel="noopener noreffer">https://www.cloudflare.com/learning/security/glossary/what-is-zero-trust/</a></li><li><a href=https://docs.docker.com/ target=_blank rel="noopener noreffer">https://docs.docker.com/</a></li><li><a href=https://letsencrypt.org/how-it-works/ target=_blank rel="noopener noreffer">https://letsencrypt.org/how-it-works/</a></li><li><a href=https://openid.net/connect/ target=_blank rel="noopener noreffer">https://openid.net/connect/</a></li><li><a href=https://caddyserver.com/docs/ target=_blank rel="noopener noreffer">https://caddyserver.com/docs/</a></li><li><a href=https://tailscale.com/kb/ target=_blank rel="noopener noreffer">https://tailscale.com/kb/</a></li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2025-12-11</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/headscale-self-hosted-alternatif-tailscale/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/headscale/>Headscale</a>,&nbsp;<a href=/tags/tailscale/>Tailscale</a>,&nbsp;<a href=/tags/vpn/>VPN</a>,&nbsp;<a href=/tags/mesh/>Mesh</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/canary-deployment-dan-mirroring-dengan-traefik/ class=prev rel=prev title="Canary Deployment dan Mirroring Dengan Traefik"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Canary Deployment dan Mirroring Dengan Traefik</a></div></div><div id=comments><div id=disqus_thread class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://disqus.com/?ref_noscript>Disqus</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2020 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=http://github.com/anwareset target=_blank>anwareset</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css><script type=text/javascript src=https://anwars-blog.disqus.com/embed.js defer></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/typeit@8.6.0/dist/index.umd.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},data:{"id-1":"deployer&nbsp","id-2":"deployer&nbsp"},lightgallery:!0,search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"},typeit:{cursorChar:"&nbsp _",cursorSpeed:1e3,data:{"id-1":["id-1"],"id-2":["id-2"]},duration:-1,speed:75}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>