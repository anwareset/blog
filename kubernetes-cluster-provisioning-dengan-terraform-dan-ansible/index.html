<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="noodp">
<meta http-equiv=x-ua-compatible content="IE=edge, chrome=1">
<title>Kubernetes Cluster Provisioning dengan Terraform dan Ansible - Anwar's Blog</title><meta name=Description content="Provisioning Kubernetes dengan Terraform dan Ansible di AWS menggunakan spesifikasi instance minimal."><meta property="og:title" content="Kubernetes Cluster Provisioning dengan Terraform dan Ansible">
<meta property="og:description" content="Provisioning Kubernetes dengan Terraform dan Ansible di AWS menggunakan spesifikasi instance minimal.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://init.web.id/kubernetes-cluster-provisioning-dengan-terraform-dan-ansible/"><meta property="og:image" content="https://init.web.id/kubernetes-cluster-provisioning-dengan-terraform-dan-ansible/cover.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-01-17T15:12:37+07:00">
<meta property="article:modified_time" content="2021-01-31T21:05:11+07:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://init.web.id/kubernetes-cluster-provisioning-dengan-terraform-dan-ansible/cover.png">
<meta name=twitter:title content="Kubernetes Cluster Provisioning dengan Terraform dan Ansible">
<meta name=twitter:description content="Provisioning Kubernetes dengan Terraform dan Ansible di AWS menggunakan spesifikasi instance minimal.">
<meta name=application-name content="Anwar's Blog">
<meta name=apple-mobile-web-app-title content="Anwar's Blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://init.web.id/kubernetes-cluster-provisioning-dengan-terraform-dan-ansible/><link rel=prev href=https://init.web.id/integrasi-sysdig-monitor-di-openshift/><link rel=next href=https://init.web.id/integrasi-github-pages-dengan-cloudflare-cdn/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Kubernetes Cluster Provisioning dengan Terraform dan Ansible","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/init.web.id\/kubernetes-cluster-provisioning-dengan-terraform-dan-ansible\/"},"image":[{"@type":"ImageObject","url":"https:\/\/init.web.id\/kubernetes-cluster-provisioning-dengan-terraform-dan-ansible\/cover.png","width":1e3,"height":420}],"genre":"posts","keywords":"Kubernetes, Terraform, Ansible, AWS","wordcount":2537,"url":"https:\/\/init.web.id\/kubernetes-cluster-provisioning-dengan-terraform-dan-ansible\/","datePublished":"2021-01-17T15:12:37+07:00","dateModified":"2021-01-31T21:05:11+07:00","license":"\u003ca href=\"https://creativecommons.org/licenses/by-nc/4.0/\" target=\"_blank\" rel=\"noopener\"\u003eCC BY-NC 4.0\u003c/a\u003e","publisher":{"@type":"Organization","name":"anwareset","logo":"https:\/\/github.com\/anwareset.png"},"author":{"@type":"Person","name":"anwareset"},"description":"Provisioning Kubernetes dengan Terraform dan Ansible di AWS menggunakan spesifikasi instance minimal."}</script></head>
<body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'white'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'white'==='dark')&&document.body.setAttribute('theme','dark')</script>
<div id=mask></div><div class=wrapper><header class=desktop id=header-desktop>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title="Anwar's Blog"><span class=header-title-pre><i class="fas fa-hashtag"></i>&nbsp</span><span id=id-1 class=typeit></span></a>
</div>
<div class=menu>
<div class=menu-inner><a class=menu-item href=/posts/> Posts </a><a class=menu-item href=/categories/> Categories </a><a class=menu-item href=/about/> About </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search>
<i class="fas fa-search fa-fw"></i>
</a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear>
<i class="fas fa-times-circle fa-fw"></i>
</a>
<span class="search-button search-loading" id=search-loading-desktop>
<i class="fas fa-spinner fa-fw fa-spin"></i>
</span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i>
</a>
</div>
</div>
</div>
</header><header class=mobile id=header-mobile>
<div class=header-container>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title="Anwar's Blog"><span class=header-title-pre><i class="fas fa-hashtag"></i>&nbsp</span><span id=id-2 class=typeit></span></a>
</div>
<div class=menu-toggle id=menu-toggle-mobile>
<span></span><span></span><span></span>
</div>
</div>
<div class=menu id=menu-mobile><div class=search-wrapper>
<div class="search mobile" id=search-mobile>
<input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search>
<i class="fas fa-search fa-fw"></i>
</a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear>
<i class="fas fa-times-circle fa-fw"></i>
</a>
<span class="search-button search-loading" id=search-loading-mobile>
<i class="fas fa-spinner fa-fw fa-spin"></i>
</span>
</div>
<a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>
Cancel
</a>
</div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/about/ title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i>
</a></div>
</div>
</header>
<div class="search-dropdown desktop">
<div id=search-dropdown-desktop></div>
</div>
<div class="search-dropdown mobile">
<div id=search-dropdown-mobile></div>
</div>
<main class=main>
<div class=container><div class=toc id=toc-auto>
<h2 class=toc-title>Contents</h2>
<div class=toc-content id=toc-content-auto></div>
</div><article class="page single"><h1 class="single-title animated flipInX">Kubernetes Cluster Provisioning dengan Terraform dan Ansible</h1><div class=post-meta>
<div class=post-meta-line><span class=post-author><a href=https://init.web.id/about title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>anwareset</a></span>&nbsp;<span class=post-category>included in <a href=/categories/platform/><i class="far fa-folder fa-fw"></i>Platform</a></span></div>
<div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-01-17>2021-01-17</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;2537 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;12 minutes&nbsp;</div>
</div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/kubernetes-cluster-provisioning-dengan-terraform-dan-ansible/cover.png data-srcset="/kubernetes-cluster-provisioning-dengan-terraform-dan-ansible/cover.png, /kubernetes-cluster-provisioning-dengan-terraform-dan-ansible/cover.png 1.5x, /kubernetes-cluster-provisioning-dengan-terraform-dan-ansible/cover.png 2x" data-sizes=auto alt=/kubernetes-cluster-provisioning-dengan-terraform-dan-ansible/cover.png title="Provisioning Kubernetes dengan Terraform dan Ansible di AWS menggunakan spesifikasi instance minimal."></div><div class="details toc" id=toc-static kept>
<div class="details-summary toc-title">
<span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span>
</div>
<div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents>
<ul>
<li><a href=#struktur-klaster>Struktur Klaster</a>
<ul>
<li><a href=#provisioning>Provisioning</a></li>
</ul>
</li>
<li><a href=#prerequisites>Prerequisites</a>
<ul>
<li><a href=#access-key>Access Key</a></li>
<li><a href=#vpc>VPC</a></li>
<li><a href=#ssh-key>SSH Key</a></li>
</ul>
</li>
<li><a href=#infrastructure-provisioning>Infrastructure Provisioning</a>
<ul>
<li><a href=#pasang-paket-terraform>Pasang Paket Terraform</a></li>
<li><a href=#script-terraform>Script Terraform</a></li>
<li><a href=#eksekusi-terraform>Eksekusi Terraform</a></li>
</ul>
</li>
<li><a href=#configuration-provisioning>Configuration Provisioning</a>
<ul>
<li><a href=#pasang-paket-ansible>Pasang Paket Ansible</a></li>
<li><a href=#konfigurasi-ansible>Konfigurasi Ansible</a></li>
<li><a href=#inventory-ansible-playbook>Inventory Ansible Playbook</a></li>
<li><a href=#docker>Docker</a></li>
<li><a href=#bootstraping-kubernetes>Bootstraping Kubernetes</a></li>
<li><a href=#joining-cluster>Joining Cluster</a></li>
</ul>
</li>
<li><a href=#post-installation>Post Installation</a>
<ul>
<li><a href=#menghapus-worker-node-elastic-ip>Menghapus Worker Node Elastic IP</a></li>
<li><a href=#ubah-label-worker-node>Ubah Label Worker Node</a></li>
</ul>
</li>
<li><a href=#pengujian>Pengujian</a></li>
<li><a href=#kesimpulan>Kesimpulan</a></li>
<li><a href=#referensi>Referensi</a></li>
</ul>
</nav></div>
</div><div class=content id=content><p>Kubernetes Vanilla atau versi Kubernetes orisinil merupakan aplikasi opensource untuk <em>Container Orchestration</em> dengan berbagai fleksibilitas yang dapat diintegrasikan lebih lanjut bersama komponen atau tools lain dari pihak ketiga. Berbeda dengan distribusi Kubernetes (seperti OpenShift dan OKD) yang menawarkan kemudahan dalam instalasi, Kubernetes (atau sering disebut k8s) seringkali membutuhkan <em>effort</em> yang lebih besar dalam membangun klaster-nya jika dilakukan secara manual tanpa layanan dari vendor atau <em>cloud provider</em> (seperti EKS atau GKS). Namun sebenarnya kita dapat melakukannya dengan lebih <em>effortless</em> menggunakan tools untuk <em>provisioning</em> infrastruktur maupun konfigurasi, seperti Terraform dan Ansible.</p>
<h2 id=struktur-klaster>Struktur Klaster</h2>
<p>Pada artikel ini saya akan membangun klaster Kubernetes yang terdiri dari satu Control Plane atau Master Node, serta dua Worker Node. Untuk pengelolaan container di dalam klaster saya akan menggunakan Docker. Infrastruktur akan didirikan di <em>cloud provider</em> AWS (Amazon Web Service).</p>
<p><figure><a class=lightgallery href=/kubernetes-cluster-provisioning-dengan-terraform-dan-ansible/klaster-kubernetes.png title="Klaster Kubernetes" data-thumbnail=/kubernetes-cluster-provisioning-dengan-terraform-dan-ansible/klaster-kubernetes.png data-sub-html="<h2>Klaster Kubernetes</h2><p>Klaster Kubernetes</p>">
<img class=lazyload src=/svg/loading.min.svg data-src=klaster-kubernetes.png data-srcset="/kubernetes-cluster-provisioning-dengan-terraform-dan-ansible/klaster-kubernetes.png, klaster-kubernetes.png 1.5x, /kubernetes-cluster-provisioning-dengan-terraform-dan-ansible/klaster-kubernetes.png 2x" data-sizes=auto alt=/kubernetes-cluster-provisioning-dengan-terraform-dan-ansible/klaster-kubernetes.png>
</a><figcaption class=image-caption>Klaster Kubernetes</figcaption>
</figure></p>
<h3 id=provisioning>Provisioning</h3>
<p><strong>Provisioning</strong> dalam urusan <em>cloud native</em> sering dianggap sebagai proses menyediakan suatu layanan. Segala proses yang terjadi dalam menyediakan layanan tersebut dapat dilakukan secara manual, namun seiring berkembangnya zaman tentu saja kini banyak sekali tools yang bermunculan dan menawarkan kemampuan untuk membuat <em>process automation</em>. Misalnya pada artikel ini, <a href=https://registry.terraform.io/providers/hashicorp/aws/latest/docs target=_blank rel="noopener noreffer"><strong>Terraform</strong></a> akan digunakan untuk melakukan provisioning infrastruktur pada AWS. Sementara dalam melakukan konfigurasi atau <em>setup</em> setiap instance, <a href=https://docs.ansible.com/ansible/latest/user_guide/playbooks.html target=_blank rel="noopener noreffer"><strong>Ansible Playbook</strong></a> adalah tools yang akan bertanggung jawab untuk melakukannya. Ansible Playbook akan melakukan beberapa proses mulai dari update sistem operasi, setup Docker, memasang <code>kubelet</code>, <code>etcd</code>, membuat token bagi worker node hingga berbagai keperluan <em>setup</em> k8s lainnya sampai selesai.</p>
<hr>
<h2 id=prerequisites>Prerequisites</h2>
<p>Pastikan beberapa prasyarat berikut ini sudah terpenuhi sebelum melakukan tahap lebih lanjut.</p>
<h3 id=access-key>Access Key</h3>
<p>Untuk mendapatkan access key AWS, kita harus memiliki akun AWS. Access Key ini sama dengan yang biasanya digunakan sebagai credentials <code>aws-cli</code>, dan pada artikel ini access key tersebut akan dipakai oleh Terraform untuk mengeksekusi perintah sesuai dengan script yang kita buat. Untuk lebih lengkapnya silahkan lihat <a href=https://docs.aws.amazon.com/powershell/latest/userguide/pstools-appendix-sign-up.html#get-access-keys target=_blank rel="noopener noreffer">dokumentasi resmi AWS</a>. Simpan access key tersebut ke dalam sebuah file, misalnya <code>credentials</code> seperti berikut ini.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>[default]
aws_access_key_id=AKIA3ANXUSNAUATXXXXX
aws_secret_access_key=+JDR1HWw4vrcFrLqbf+ewv/nJL/L6TlVAhwXXXXX
</code></pre></td></tr></table>
</div>
</div><h3 id=vpc>VPC</h3>
<p>Pada umumnya <em>by-default</em> AWS sudah memiliki VPC (Virtual Private Cloud), namun jika belum kita dapat membuatnya sendiri dengan perintah berikut.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ aws ec2 create-default-vpc --availability-zone us-east-1
</code></pre></td></tr></table>
</div>
</div><p>Saya akan menggunakan default VPC Subnet yang sudah ada pada AWS. Namun jika belum ada maka kita dapat membuatnya sendiri seperti berikut.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ aws ec2 create-default-subnet --availability-zone us-east-1a 
</code></pre></td></tr></table>
</div>
</div><p>Kita akan membutuhkan <strong>id</strong> dari Subnet VPC yang telah kita buat untuk tahap selanjutnya.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ aws ec2 describe-subnets --region us-east-1
</code></pre></td></tr></table>
</div>
</div><p>Catat dan simpan <strong>id</strong> dari Subnet VPC yang telah kita buat.</p>
<h3 id=ssh-key>SSH Key</h3>
<p>Buat sebuah SSH Key bagi instance AWS yang akan kita dirikan. Untuk membuatnya saya menggunakan <code>aws-cli</code> dengan perintah berikut.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ aws ec2 create-key-pair --region us-east-1 --key-name infra-k8s --query <span class=s1>&#39;KeyMaterial&#39;</span> --output text &gt; infra-k8s.pem
</code></pre></td></tr></table>
</div>
</div><p>Nantinya perintah tersebut akan menghasilkan sebuah file SSH Key bernama <code>infra-k8s.pem</code>. Selanjutnya kita perlu merubah permissionnya supaya dapat digunakan untuk mengakses instance.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ chmod <span class=m>400</span> infra-k8s.pem
</code></pre></td></tr></table>
</div>
</div><div class="details admonition info open">
<div class="details-summary admonition-title">
<i class="icon fas fa-info-circle fa-fw"></i>Info<i class="details-icon fas fa-angle-right fa-fw"></i>
</div>
<div class=details-content>
<div class=admonition-content>Dalam artikel ini saya menggunakan region <code>us-east-1</code> atau North Virginia. Jika ingin menggunakan regional lain, silahkan lihat <a href=https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html target=_blank rel="noopener noreffer">dokumentasi resmi AWS</a>.</div>
</div>
</div>
<hr>
<h2 id=infrastructure-provisioning>Infrastructure Provisioning</h2>
<h3 id=pasang-paket-terraform>Pasang Paket Terraform</h3>
<p>Pasang paket <code>terraform</code> pada komputer lokal seperti berikut.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ sudo pacman -Sy terraform
</code></pre></td></tr></table>
</div>
</div><div class="details admonition info open">
<div class="details-summary admonition-title">
<i class="icon fas fa-info-circle fa-fw"></i>Info<i class="details-icon fas fa-angle-right fa-fw"></i>
</div>
<div class=details-content>
<div class=admonition-content>Saya menggunakan sistem operasi GNU/Linux dengan distro Arch-based yang memiliki package manager <code>pacman</code>. Silahkan sesuaikan dengan perintah package manager pada distro masing-masing.</div>
</div>
</div>
<h3 id=script-terraform>Script Terraform</h3>
<p>Selanjutnya silahkan buat file baru untuk menulis script terraform. Misalnya saya membuat file <code>infra.tf</code> yang akan berisi script Terraform seperti berikut ini.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=c1>## AWS Provider
</span><span class=c1></span><span class=nx>terraform</span> <span class=p>{</span>
  <span class=nx>required_providers</span> <span class=p>{</span>
    <span class=na>aws</span> = <span class=p>{</span>
      <span class=na>source</span>  = <span class=s2>&#34;hashicorp/aws&#34;</span>
      <span class=na>version</span> = <span class=s2>&#34;~&gt; 3.0&#34;</span>
    <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}</span><span class=c1>
</span><span class=c1>
</span><span class=c1>## Init Credentials Profile and Region
</span><span class=c1></span><span class=kr>provider</span> <span class=s2>&#34;aws&#34;</span> <span class=p>{</span>
  <span class=na>profile</span> = <span class=s2>&#34;default&#34;</span>
  <span class=na>region</span>  = <span class=s2>&#34;us-east-1&#34;</span>
  <span class=na>shared_credentials_file</span> = <span class=s2>&#34;credentials&#34;</span>
<span class=p>}</span><span class=c1>
</span><span class=c1>
</span><span class=c1>## Public Security Group
</span><span class=c1></span><span class=kr>resource</span> <span class=s2>&#34;aws_security_group&#34;</span> <span class=s2>&#34;public-sec&#34;</span> <span class=p>{</span>
  <span class=na>name</span>        = <span class=s2>&#34;public&#34;</span>
  <span class=na>description</span> = <span class=s2>&#34;Public Server Security Group&#34;</span><span class=c1>
</span><span class=c1>
</span><span class=c1>## SSH, HTTP, HTTPS Access
</span><span class=c1></span>  <span class=nx>ingress</span> <span class=p>{</span>
    <span class=na>from_port</span>   = <span class=m>22</span>
    <span class=na>to_port</span>     = <span class=m>22</span>
    <span class=na>protocol</span>    = <span class=s2>&#34;tcp&#34;</span>
    <span class=na>cidr_blocks</span> = <span class=p>[</span><span class=s2>&#34;0.0.0.0/0&#34;</span><span class=p>]</span>
  <span class=p>}</span>
  <span class=nx>ingress</span> <span class=p>{</span>
    <span class=na>from_port</span>   = <span class=m>80</span>
    <span class=na>to_port</span>     = <span class=m>80</span>
    <span class=na>protocol</span>    = <span class=s2>&#34;tcp&#34;</span>
    <span class=na>cidr_blocks</span> = <span class=p>[</span><span class=s2>&#34;0.0.0.0/0&#34;</span><span class=p>]</span>
  <span class=p>}</span>
  <span class=nx>ingress</span> <span class=p>{</span>
    <span class=na>from_port</span>   = <span class=m>443</span>
    <span class=na>to_port</span>     = <span class=m>443</span>
    <span class=na>protocol</span>    = <span class=s2>&#34;tcp&#34;</span>
    <span class=na>cidr_blocks</span> = <span class=p>[</span><span class=s2>&#34;0.0.0.0/0&#34;</span><span class=p>]</span>
  <span class=p>}</span><span class=c1>
</span><span class=c1>## Kubernetes Cluster  
</span><span class=c1></span>  <span class=nx>ingress</span> <span class=p>{</span>
    <span class=na>from_port</span>   = <span class=m>6443</span>
    <span class=na>to_port</span>     = <span class=m>6443</span>
    <span class=na>protocol</span>    = <span class=s2>&#34;tcp&#34;</span>
    <span class=na>cidr_blocks</span> = <span class=p>[</span><span class=s2>&#34;0.0.0.0/0&#34;</span><span class=p>]</span>
  <span class=p>}</span>
  <span class=nx>ingress</span> <span class=p>{</span>
    <span class=na>from_port</span>   = <span class=m>2379</span>
    <span class=na>to_port</span>     = <span class=m>2380</span>
    <span class=na>protocol</span>    = <span class=s2>&#34;tcp&#34;</span>
    <span class=na>cidr_blocks</span> = <span class=p>[</span><span class=s2>&#34;0.0.0.0/0&#34;</span><span class=p>]</span>
  <span class=p>}</span>
  <span class=nx>ingress</span> <span class=p>{</span>
    <span class=na>from_port</span>   = <span class=m>10250</span>
    <span class=na>to_port</span>     = <span class=m>10250</span>
    <span class=na>protocol</span>    = <span class=s2>&#34;tcp&#34;</span>
    <span class=na>cidr_blocks</span> = <span class=p>[</span><span class=s2>&#34;0.0.0.0/0&#34;</span><span class=p>]</span>
  <span class=p>}</span>
  <span class=nx>ingress</span> <span class=p>{</span>
    <span class=na>from_port</span>   = <span class=m>10251</span>
    <span class=na>to_port</span>     = <span class=m>10251</span>
    <span class=na>protocol</span>    = <span class=s2>&#34;tcp&#34;</span>
    <span class=na>cidr_blocks</span> = <span class=p>[</span><span class=s2>&#34;0.0.0.0/0&#34;</span><span class=p>]</span>
  <span class=p>}</span>
  <span class=nx>ingress</span> <span class=p>{</span>
    <span class=na>from_port</span>   = <span class=m>10252</span>
    <span class=na>to_port</span>     = <span class=m>10252</span>
    <span class=na>protocol</span>    = <span class=s2>&#34;tcp&#34;</span>
    <span class=na>cidr_blocks</span> = <span class=p>[</span><span class=s2>&#34;0.0.0.0/0&#34;</span><span class=p>]</span>
  <span class=p>}</span>
  <span class=nx>egress</span> <span class=p>{</span>
    <span class=na>from_port</span>   = <span class=m>0</span>
    <span class=na>to_port</span>     = <span class=m>0</span>
    <span class=na>protocol</span>    = <span class=s2>&#34;-1&#34;</span>
    <span class=na>cidr_blocks</span> = <span class=p>[</span><span class=s2>&#34;0.0.0.0/0&#34;</span><span class=p>]</span>
  <span class=p>}</span>
  <span class=na>tags</span> = <span class=p>{</span>
    <span class=na>Name</span>        = <span class=s2>&#34;public&#34;</span>
    <span class=na>Description</span> = <span class=s2>&#34;Public Server Security Group&#34;</span>
  <span class=p>}</span>
<span class=p>}</span><span class=c1>
</span><span class=c1>
</span><span class=c1>## Elastic IP for Public Instance
</span><span class=c1></span><span class=kr>resource</span> <span class=s2>&#34;aws_eip&#34;</span> <span class=s2>&#34;lb&#34;</span> <span class=p>{</span>
  <span class=na>instance</span> = <span class=nx>aws_instance</span><span class=p>.</span><span class=nx>public</span><span class=p>.</span><span class=nx>id</span>
<span class=p>}</span><span class=c1>
</span><span class=c1>
</span><span class=c1>## Create Public Instance
</span><span class=c1></span><span class=kr>resource</span> <span class=s2>&#34;aws_instance&#34;</span> <span class=s2>&#34;public&#34;</span> <span class=p>{</span>
  <span class=na>ami</span>               = <span class=s2>&#34;ami-00ddb0e5626798373&#34;</span>
  <span class=na>instance_type</span>     = <span class=s2>&#34;t2.medium&#34;</span>
  <span class=na>source_dest_check</span> = <span class=kc>false</span>
  <span class=na>key_name</span>          = <span class=s2>&#34;infra-k8s&#34;</span>
  <span class=na>subnet_id</span>         = <span class=s2>&#34;subnet-0f5a08d3063a6b742&#34;</span>
  <span class=na>private_ip</span>        = <span class=s2>&#34;172.31.16.20&#34;</span>
  <span class=na>vpc_security_group_ids</span>   = <span class=nx>aws_security_group</span><span class=p>.</span><span class=nx>public</span><span class=o>-</span><span class=nx>sec</span><span class=p>.</span><span class=o>*</span><span class=p>.</span><span class=nx>id</span>
  <span class=na>tags</span> = <span class=p>{</span>
    <span class=na>Name</span> = <span class=s2>&#34;public&#34;</span>
  <span class=p>}</span><span class=c1>
</span><span class=c1>
</span><span class=c1>## Disk Space
</span><span class=c1></span>  <span class=nx>root_block_device</span> <span class=p>{</span>
    <span class=na>delete_on_termination</span> = <span class=kc>true</span>
    <span class=na>encrypted</span>             = <span class=kc>false</span>
    <span class=na>iops</span>                  = <span class=m>100</span>
    <span class=na>volume_size</span>           = <span class=m>10</span>
  <span class=p>}</span>
<span class=p>}</span><span class=c1>
</span><span class=c1>
</span><span class=c1>## Node Security Group
</span><span class=c1></span><span class=kr>resource</span> <span class=s2>&#34;aws_security_group&#34;</span> <span class=s2>&#34;node-sec&#34;</span> <span class=p>{</span>
  <span class=na>name</span>        = <span class=s2>&#34;node&#34;</span>
  <span class=na>description</span> = <span class=s2>&#34;Node/Worker Security Group&#34;</span><span class=c1>
</span><span class=c1>
</span><span class=c1>## SSH Access
</span><span class=c1></span>  <span class=nx>ingress</span> <span class=p>{</span>
    <span class=na>from_port</span>       = <span class=m>22</span>
    <span class=na>to_port</span>         = <span class=m>22</span>
    <span class=na>protocol</span>        = <span class=s2>&#34;tcp&#34;</span><span class=c1>
</span><span class=c1>
</span><span class=c1>## Close all traffic IP after setup!
</span><span class=c1>    #cidr_blocks     = [&#34;172.31.16.20/32&#34;]
</span><span class=c1></span>    <span class=na>cidr_blocks</span>    = <span class=p>[</span><span class=s2>&#34;0.0.0.0/0&#34;</span><span class=p>]</span>
  <span class=p>}</span><span class=c1>
</span><span class=c1>## Kubernetes Cluster  
</span><span class=c1></span>  <span class=nx>ingress</span> <span class=p>{</span>
    <span class=na>from_port</span>   = <span class=m>10250</span>
    <span class=na>to_port</span>     = <span class=m>10250</span>
    <span class=na>protocol</span>    = <span class=s2>&#34;tcp&#34;</span>
    <span class=na>cidr_blocks</span> = <span class=p>[</span><span class=s2>&#34;172.31.16.20/32&#34;</span><span class=p>]</span>
  <span class=p>}</span>
  <span class=nx>ingress</span> <span class=p>{</span>
    <span class=na>from_port</span>   = <span class=m>10255</span>
    <span class=na>to_port</span>     = <span class=m>10255</span>
    <span class=na>protocol</span>    = <span class=s2>&#34;tcp&#34;</span>
    <span class=na>cidr_blocks</span> = <span class=p>[</span><span class=s2>&#34;172.31.16.20/32&#34;</span><span class=p>]</span>
  <span class=p>}</span>
  <span class=nx>ingress</span> <span class=p>{</span>
    <span class=na>from_port</span>   = <span class=m>30000</span>
    <span class=na>to_port</span>     = <span class=m>32767</span>
    <span class=na>protocol</span>    = <span class=s2>&#34;tcp&#34;</span>
    <span class=na>cidr_blocks</span> = <span class=p>[</span><span class=s2>&#34;172.31.16.20/32&#34;</span><span class=p>]</span>
  <span class=p>}</span>
  <span class=nx>ingress</span> <span class=p>{</span>
    <span class=na>from_port</span>   = <span class=m>3000</span>
    <span class=na>to_port</span>     = <span class=m>3000</span>
    <span class=na>protocol</span>    = <span class=s2>&#34;tcp&#34;</span>
    <span class=na>cidr_blocks</span> = <span class=p>[</span><span class=s2>&#34;172.31.16.20/32&#34;</span><span class=p>]</span>
  <span class=p>}</span>
  <span class=nx>egress</span> <span class=p>{</span>
    <span class=na>from_port</span>   = <span class=m>0</span>
    <span class=na>to_port</span>     = <span class=m>0</span>
    <span class=na>protocol</span>    = <span class=s2>&#34;-1&#34;</span>
    <span class=na>cidr_blocks</span> = <span class=p>[</span><span class=s2>&#34;0.0.0.0/0&#34;</span><span class=p>]</span>
  <span class=p>}</span>
  <span class=na>tags</span> = <span class=p>{</span>
    <span class=na>Name</span>        = <span class=s2>&#34;node&#34;</span>
    <span class=na>Description</span> = <span class=s2>&#34;Node/Worker Security Group&#34;</span>
  <span class=p>}</span>
<span class=p>}</span><span class=c1>
</span><span class=c1>
</span><span class=c1>## Elastic IP for Node Server (Temporary)
</span><span class=c1></span><span class=kr>resource</span> <span class=s2>&#34;aws_eip&#34;</span> <span class=s2>&#34;lb-node&#34;</span> <span class=p>{</span>
  <span class=na>count</span> = <span class=m>2</span>
  <span class=na>instance</span> = <span class=nx>aws_instance</span><span class=p>.</span><span class=nx>node</span><span class=p>[</span><span class=nb>count</span><span class=p>.</span><span class=nx>index</span><span class=p>].</span><span class=nx>id</span>
<span class=p>}</span><span class=c1>
</span><span class=c1>
</span><span class=c1>## Create Instance Node
</span><span class=c1></span><span class=kr>resource</span> <span class=s2>&#34;aws_instance&#34;</span> <span class=s2>&#34;node&#34;</span> <span class=p>{</span>
  <span class=na>ami</span>                         = <span class=s2>&#34;ami-00ddb0e5626798373&#34;</span>
  <span class=na>instance_type</span>               = <span class=s2>&#34;t2.small&#34;</span>
  <span class=na>associate_public_ip_address</span> = <span class=kc>false</span>
  <span class=na>source_dest_check</span>           = <span class=kc>false</span>
  <span class=na>key_name</span>                    = <span class=s2>&#34;infra-k8s&#34;</span>
  <span class=na>subnet_id</span>                   = <span class=s2>&#34;subnet-0f5a08d3063a6b742&#34;</span>
  <span class=na>vpc_security_group_ids</span>      = <span class=nx>aws_security_group</span><span class=p>.</span><span class=nx>node</span><span class=o>-</span><span class=nx>sec</span><span class=p>.</span><span class=o>*</span><span class=p>.</span><span class=nx>id</span>
  <span class=na>count</span>                       = <span class=m>2</span>
  <span class=na>tags</span> = <span class=p>{</span>
    <span class=na>Name</span> = <span class=s2>&#34;node-</span><span class=si>${</span><span class=nb>count</span><span class=p>.</span><span class=nx>index</span> <span class=o>+</span> <span class=m>1</span><span class=si>}</span><span class=s2>&#34;</span>
  <span class=p>}</span><span class=c1>
</span><span class=c1>
</span><span class=c1>## Disk Space
</span><span class=c1></span>    <span class=nx>root_block_device</span> <span class=p>{</span>
    <span class=na>delete_on_termination</span> = <span class=kc>true</span>
    <span class=na>encrypted</span>             = <span class=kc>false</span>
    <span class=na>iops</span>                  = <span class=m>100</span>
    <span class=na>volume_size</span>           = <span class=m>10</span>
  <span class=p>}</span>
<span class=p>}</span>

</code></pre></td></tr></table>
</div>
</div><div class="details admonition warning open">
<div class="details-summary admonition-title">
<i class="icon fas fa-exclamation-triangle fa-fw"></i>Perhatian<i class="details-icon fas fa-angle-right fa-fw"></i>
</div>
<div class=details-content>
<div class=admonition-content>Sesuaikan variabel <code>subnet_id</code> dengan <strong>id</strong> Subnet VPC yang telah kita buat <a href=#vpc rel>sebelumnya</a>. Sedangkan variabel <code>ami</code> merupakan <strong>id</strong> dari Amazon Machine Image yang value nya tergantung dari distro apa yang akan kita jalankan pada setiap instance EC2 untuk informasi lebih lanjut kita dapat melihatnya dari <a href=https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/finding-an-ami.html target=_blank rel="noopener noreffer">dokumentasi resmi AWS</a> karena setiap region dan distro hingga sistem operasi memiliki AMI ID yang berbeda-beda. Terlihat bahwa saya membuka seluruh traffic dari <em>inbound</em> dan <em>outbound</em> yang tentu saja tidaklah aman, sesuaikan dengan kebutuhan <a href=https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#check-required-ports target=_blank rel="noopener noreffer">port Kubernetes</a> pada umumnya.</div>
</div>
</div>
<p>Inisialiasi terraform untuk mengunduh dependency yang diperlukan dengan perintah berikut.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ terraform init
</code></pre></td></tr></table>
</div>
</div><h3 id=eksekusi-terraform>Eksekusi Terraform</h3>
<p>Sekarang jalankan provisioning menggunakan terraform sesuai dengan script yang telah dibuat sebelumnya.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ terraform apply
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id=configuration-provisioning>Configuration Provisioning</h2>
<h3 id=pasang-paket-ansible>Pasang Paket Ansible</h3>
<p>Pasang <code>ansible</code> pada komputer lokal menggunakan perintah berikut.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ sudo pacman -Sy ansible
</code></pre></td></tr></table>
</div>
</div><h3 id=konfigurasi-ansible>Konfigurasi Ansible</h3>
<p>Kita perlu membuat sebuah file bernama <code>ansible.cfg</code> yang berisi konfigurasi seperti berikut.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>[defaults]
inventory = inventory
Private_key_file = infra-k8s.pem
remote_user = ubuntu
ansible_python_interpreter = /usr/bin/python3
host_key_checking = false
remote_tmp = /tmp/.ansible-${USER}/tmp
</code></pre></td></tr></table>
</div>
</div><div class="details admonition warning open">
<div class="details-summary admonition-title">
<i class="icon fas fa-exclamation-triangle fa-fw"></i>Perhatian<i class="details-icon fas fa-angle-right fa-fw"></i>
</div>
<div class=details-content>
<div class=admonition-content>Variabel <code>remote_user</code> adalah user pada instance EC2 yang akan dipakai untuk penerapan provisioning, <em>by-default</em> pada AWS untuk AMI <strong>Ubuntu 18</strong> menggunakan user <code>ubuntu</code>. Jika menggunakan AMI lain maka kita perlu menyesuaikannya.</div>
</div>
</div>
<h3 id=inventory-ansible-playbook>Inventory Ansible Playbook</h3>
<p>Jalankan perintah berikut untuk mendapatkan IP Publik dari Master Node.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ aws ec2 describe-instances  <span class=se>\
</span><span class=se></span>    --region us-east-1 <span class=se>\
</span><span class=se></span>    --filters <span class=s2>&#34;Name=tag-value,Values=public&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>Jalankan perintah berikut untuk mendapatkan IP Publik dari Worker Node pertama.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ aws ec2 describe-instances  <span class=se>\
</span><span class=se></span>    --region us-east-1 <span class=se>\
</span><span class=se></span>    --filters <span class=s2>&#34;Name=tag-value,Values=node-1&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>Jalankan perintah berikut untuk mendapatkan IP Publik dari Worker Node pertama.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ aws ec2 describe-instances  <span class=se>\
</span><span class=se></span>    --region us-east-1 <span class=se>\
</span><span class=se></span>    --filters <span class=s2>&#34;Name=tag-value,Values=node-2&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>Kemudian masukan ketiga IP tersebut ke dalam file bernama <code>inventory</code> sehingga kurang lebih isinya akan menjadi seperti berikut.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>[public]
18.233.242.19

[nodes]
3.224.63.65
54.198.25.43
</code></pre></td></tr></table>
</div>
</div><h3 id=docker>Docker</h3>
<p>Selanjutnya saya membuat file baru bernama <code>docker.yml</code> yang berisi script untuk melakukan update sistem operasi dan <em>setup</em> Docker.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml>- <span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class=l>all</span><span class=w>
</span><span class=w>  </span><span class=nt>gather_facts</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Update &amp; Upgrade</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>apt</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>upgrade</span><span class=p>:</span><span class=w> </span><span class=l>dist</span><span class=w>
</span><span class=w>        </span><span class=nt>update_cache</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Install Docker Requiremts</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>apt</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w>
</span><span class=w>          </span>- <span class=l>ca-certificates</span><span class=w>
</span><span class=w>          </span>- <span class=l>curl</span><span class=w>
</span><span class=w>          </span>- <span class=l>gnupg-agent</span><span class=w>
</span><span class=w>          </span>- <span class=l>python3-pip</span><span class=w>
</span><span class=w>          </span>- <span class=l>software-properties-common</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>GPG Key Docker</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>apt_key</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=l>https://download.docker.com/linux/ubuntu/gpg</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Repo Docker</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>apt_repository</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>repo</span><span class=p>:</span><span class=w> </span><span class=l>deb [arch=amd64] https://download.docker.com/linux/ubuntu bionic stable</span><span class=w>
</span><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>present</span><span class=w>
</span><span class=w>        </span><span class=nt>update_cache</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Install Docker</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>apt</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>force</span><span class=p>:</span><span class=w> </span><span class=kc>True</span><span class=w>
</span><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w>
</span><span class=w>          </span>- <span class=l>docker-ce</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Hold Docker</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>dpkg_selections</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>docker-ce</span><span class=w>
</span><span class=w>        </span><span class=nt>selection</span><span class=p>:</span><span class=w> </span><span class=l>hold</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Install Docker Py as root</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=l>pip3 install docker-py</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Install Docker Py as normal user</span><span class=w>
</span><span class=w>      </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=l>pip3 install docker-py</span><span class=w>
</span><span class=w>    
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Enable service docker, and enable persistently</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>docker</span><span class=w>
</span><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Add the user &#39;ubuntu&#39; to docker group</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>user</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu</span><span class=w>
</span><span class=w>        </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class=l>docker</span><span class=w>
</span></code></pre></td></tr></table>
</div>
</div><p>Terapkan script yang telah kita buat dengan Ansible Playbook seperti berikut.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ ansible docker.yml
</code></pre></td></tr></table>
</div>
</div><p>Jika berhasil maka akan muncul tampilan seperti berikut ini.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>PLAY RECAP *******************************************************************************************************
18.233.242.19              : ok=10   changed=9    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
3.224.63.65                : ok=10   changed=9    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
54.198.25.43               : ok=10   changed=9    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
</code></pre></td></tr></table>
</div>
</div><h3 id=bootstraping-kubernetes>Bootstraping Kubernetes</h3>
<p>Sekarang buat file baru bernama <code>k8s.yml</code> yang berisi script untuk melakukan <em>setup</em> Kubernetes.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml>- <span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class=l>all</span><span class=w>
</span><span class=w>  </span><span class=nt>gather_facts</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Add Google official GPG key</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>apt_key</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=l>https://packages.cloud.google.com/apt/doc/apt-key.gpg</span><span class=w>
</span><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>present</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Add Kubernetes Repository</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>apt_repository</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>repo</span><span class=p>:</span><span class=w> </span><span class=l>deb http://apt.kubernetes.io/ kubernetes-xenial main</span><span class=w>
</span><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>present</span><span class=w>
</span><span class=w>        </span><span class=nt>filename</span><span class=p>:</span><span class=w> </span><span class=l>kubernetes</span><span class=w>
</span><span class=w>        </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=m>0600</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Installing Kubernetes Cluster Packages</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>apt</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>force</span><span class=p>:</span><span class=w> </span><span class=kc>True</span><span class=w>
</span><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w>
</span><span class=w>          </span>- <span class=l>kubeadm</span><span class=w>
</span><span class=w>          </span>- <span class=l>kubectl</span><span class=w>
</span><span class=w>          </span>- <span class=l>kubelet</span><span class=w>
</span><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>present</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Hold kubeadm</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>dpkg_selections</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kubeadm</span><span class=w>
</span><span class=w>        </span><span class=nt>selection</span><span class=p>:</span><span class=w> </span><span class=l>hold</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Hold kubectl</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>dpkg_selections</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kubectl</span><span class=w>
</span><span class=w>        </span><span class=nt>selection</span><span class=p>:</span><span class=w> </span><span class=l>hold</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Hold kubelet</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>dpkg_selections</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kubelet</span><span class=w>
</span><span class=w>        </span><span class=nt>selection</span><span class=p>:</span><span class=w> </span><span class=l>hold</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Add line Net Bridge on sysctl.conf</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>lineinfile</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/etc/sysctl.conf</span><span class=w>
</span><span class=w>        </span><span class=nt>line</span><span class=p>:</span><span class=w> </span><span class=l>net.bridge.bridge-nf-call-iptables=1</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Add line &#39;max_map_count&#39; on sysctl.conf</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>lineinfile</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/etc/sysctl.conf</span><span class=w>
</span><span class=w>        </span><span class=nt>line</span><span class=p>:</span><span class=w> </span><span class=l>vm.max_map_count=262144</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Apply change on sysctl</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>become_method</span><span class=p>:</span><span class=w> </span><span class=l>sudo</span><span class=w>
</span><span class=w>      </span><span class=nt>shell</span><span class=p>:</span><span class=w> </span><span class=l>sysctl -p</span><span class=w>
</span><span class=w>
</span><span class=w></span>- <span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class=l>public</span><span class=w>
</span><span class=w>  </span><span class=nt>gather_facts</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Initialize k8s cluster</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>become_method</span><span class=p>:</span><span class=w> </span><span class=l>sudo</span><span class=w>
</span><span class=w>      </span><span class=nt>shell</span><span class=p>:</span><span class=w> </span><span class=l>kubeadm reset -f</span><span class=w>
</span><span class=w>    
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Start k8s init</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>become_method</span><span class=p>:</span><span class=w> </span><span class=l>sudo</span><span class=w>
</span><span class=w>      </span><span class=nt>shell</span><span class=p>:</span><span class=w> </span><span class=l>kubeadm init --pod-network-cidr=10.244.0.0/16</span><span class=w>
</span><span class=w>      </span><span class=nt>register</span><span class=p>:</span><span class=w> </span><span class=l>kubeadm_result</span><span class=w>
</span><span class=w>    </span>- <span class=nt>debug</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>var</span><span class=p>:</span><span class=w> </span><span class=l>kubeadm_result.stdout_lines</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Make configuration folder for k8s</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>become_user</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu</span><span class=w>
</span><span class=w>      </span><span class=nt>file</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>directory</span><span class=w>
</span><span class=w>        </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/home/ubuntu/.kube</span><span class=w>
</span><span class=w>        </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=m>0755</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Copy configuration k8s into home</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>copy</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>src</span><span class=p>:</span><span class=w> </span><span class=l>/etc/kubernetes/admin.conf</span><span class=w>
</span><span class=w>        </span><span class=nt>dest</span><span class=p>:</span><span class=w> </span><span class=l>/home/ubuntu/.kube/config</span><span class=w>
</span><span class=w>        </span><span class=nt>remote_src</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>        </span><span class=nt>owner</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>apply network plugin flannel</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>become_user</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu</span><span class=w>
</span><span class=w>      </span><span class=nt>shell</span><span class=p>:</span><span class=w> </span><span class=l>kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><span class=w>
</span><span class=w>
</span><span class=w></span>- <span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class=l>nodes</span><span class=w>
</span><span class=w>  </span><span class=nt>gather_facts</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span><span class=w>  </span><span class=nt>vars_prompt</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;kubeadm&#34;</span><span class=w>
</span><span class=w>      </span><span class=nt>prompt</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;kubeadm Command &#34;</span><span class=w>
</span><span class=w>      </span><span class=nt>private</span><span class=p>:</span><span class=w> </span><span class=kc>no</span><span class=w>
</span><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Reset kubeadm</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>become_method</span><span class=p>:</span><span class=w> </span><span class=l>sudo</span><span class=w>
</span><span class=w>      </span><span class=nt>shell</span><span class=p>:</span><span class=w> </span><span class=l>kubeadm reset -f</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Prune docker images</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>become_method</span><span class=p>:</span><span class=w> </span><span class=l>sudo</span><span class=w>
</span><span class=w>      </span><span class=nt>shell</span><span class=p>:</span><span class=w> </span><span class=l>sudo docker image prune -af</span><span class=w>
</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Retriving input command kubeadm</span><span class=w>
</span><span class=w>      </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span><span class=w>      </span><span class=nt>become_method</span><span class=p>:</span><span class=w> </span><span class=l>sudo</span><span class=w>
</span><span class=w>      </span><span class=nt>shell</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ kubeadm }}&#34;</span><span class=w>
</span></code></pre></td></tr></table>
</div>
</div><p>Kemudian terapkan script tersebut dengan Ansible Playbook seperti berikut.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ ansible k8s.yml
</code></pre></td></tr></table>
</div>
</div><h3 id=joining-cluster>Joining Cluster</h3>
<p>Di tengah proses, kita akan diberikan sebuah token yang harus dimasukkan secara manual. Token tersebut digunakan oleh Worker Node untuk bergabung ke dalam klaster.
<figure><a class=lightgallery href=/kubernetes-cluster-provisioning-dengan-terraform-dan-ansible/join-token.png title="Join Token" data-thumbnail=/kubernetes-cluster-provisioning-dengan-terraform-dan-ansible/join-token.png data-sub-html="<h2>Join Token</h2><p>Join Token</p>">
<img class=lazyload src=/svg/loading.min.svg data-src=join-token.png data-srcset="/kubernetes-cluster-provisioning-dengan-terraform-dan-ansible/join-token.png, join-token.png 1.5x, /kubernetes-cluster-provisioning-dengan-terraform-dan-ansible/join-token.png 2x" data-sizes=auto alt=/kubernetes-cluster-provisioning-dengan-terraform-dan-ansible/join-token.png>
</a><figcaption class=image-caption>Join Token</figcaption>
</figure></p>
<p>Jika berhasil maka akan muncul tampilan seperti berikut ini.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>PLAY RECAP *******************************************************************************************************
18.233.242.19              : <span class=nv>ok</span><span class=o>=</span><span class=m>15</span>   <span class=nv>changed</span><span class=o>=</span><span class=m>14</span>   <span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span>    <span class=nv>failed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>skipped</span><span class=o>=</span><span class=m>0</span>    <span class=nv>rescued</span><span class=o>=</span><span class=m>0</span>    <span class=nv>ignored</span><span class=o>=</span><span class=m>0</span>   
3.224.63.65                : <span class=nv>ok</span><span class=o>=</span><span class=m>12</span>   <span class=nv>changed</span><span class=o>=</span><span class=m>12</span>   <span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span>    <span class=nv>failed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>skipped</span><span class=o>=</span><span class=m>0</span>    <span class=nv>rescued</span><span class=o>=</span><span class=m>0</span>    <span class=nv>ignored</span><span class=o>=</span><span class=m>0</span>   
54.198.25.43               : <span class=nv>ok</span><span class=o>=</span><span class=m>12</span>   <span class=nv>changed</span><span class=o>=</span><span class=m>12</span>   <span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span>    <span class=nv>failed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>skipped</span><span class=o>=</span><span class=m>0</span>    <span class=nv>rescued</span><span class=o>=</span><span class=m>0</span>    <span class=nv>ignored</span><span class=o>=</span><span class=m>0</span>   
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id=post-installation>Post Installation</h2>
<h3 id=menghapus-worker-node-elastic-ip>Menghapus Worker Node Elastic IP</h3>
<p>Karena Worker Node sudah tidak lagi membutuhkan IP Publik, maka kita akan menghapusnya dengan cara merubah script file <code>infra.tf</code> yang sebelumnya kita buat. Jadikan beberapa baris konfigurasi menjadi <em>comment</em> seperti berikut ini.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>## Elastic IP for Node Server (Temporary)
#resource &#34;aws_eip&#34; &#34;lb-node&#34; {
#  count = 2
#  instance = aws_instance.node[count.index].id
#}
</code></pre></td></tr></table>
</div>
</div><p>Dan tambahkan <em>comment</em> juga pada baris konfigurasi variabel <code>associate_public_ip_address</code>.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>#associate_public_ip_address = false
</code></pre></td></tr></table>
</div>
</div><p>Kemudian jalankan kembali Terraform seperti berikut.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ terraform apply
</code></pre></td></tr></table>
</div>
</div><p>Periksa dan jika sudah benar maka ketik <strong><code>yes</code></strong> dan tekan <strong>Enter</strong>. Apabila berhasil maka akan muncul tampilan seperti berikut.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>aws_eip.lb-node[1]: Destroying... [id=eipalloc-0adb19f75c6648130]
aws_eip.lb-node[0]: Destroying... [id=eipalloc-07464709ac36cafe4]
aws_eip.lb-node[0]: Destruction complete after 5s
aws_eip.lb-node[1]: Destruction complete after 5s

Apply complete! Resources: 0 added, 0 changed, 2 destroyed.
</code></pre></td></tr></table>
</div>
</div><h3 id=ubah-label-worker-node>Ubah Label Worker Node</h3>
<p>Sekarang coba akses Master Node lewat SSH menggunakan SSH Key yang sebelumnya telah kita miliki.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ ssh -i infra-k8s.pem ubuntu@18.233.242.19
</code></pre></td></tr></table>
</div>
</div><div class="details admonition warning open">
<div class="details-summary admonition-title">
<i class="icon fas fa-exclamation-triangle fa-fw"></i>Perhatian<i class="details-icon fas fa-angle-right fa-fw"></i>
</div>
<div class=details-content>
<div class=admonition-content>Sesuaikan dengan alamat IP Publik yang dimiliki oleh Master Node atau Control Plane.</div>
</div>
</div>
<p>Setelah berhasil masuk, sekarang jalankan perintah berikut.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ kubectl get nodes
</code></pre></td></tr></table>
</div>
</div><p>Maka akan muncul daftar node yang terhubung pada klaster.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>NAME               STATUS   ROLES                  AGE     VERSION
ip-172-31-16-20    Ready    control-plane,master   8m50s   v1.20.2
ip-172-31-25-81    Ready    &lt;none&gt;                 7m41s   v1.20.2
ip-172-31-29-192   Ready    &lt;none&gt;                 7m40s   v1.20.2
</code></pre></td></tr></table>
</div>
</div><p>Ubah <strong>ROLES</strong> Worker Node dengan menambahkan label.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ kubectl label node ip-172-31-25-81 node-role.kubernetes.io/worker<span class=o>=</span>worker1
$ kubectl label node ip-172-31-29-192 node-role.kubernetes.io/worker<span class=o>=</span>worker2
</code></pre></td></tr></table>
</div>
</div><div class="details admonition warning open">
<div class="details-summary admonition-title">
<i class="icon fas fa-exclamation-triangle fa-fw"></i>Perhatian<i class="details-icon fas fa-angle-right fa-fw"></i>
</div>
<div class=details-content>
<div class=admonition-content>Sesuaikan nama node dengan <strong>NAME</strong> seperti yang muncul dari hasil pemeriksaan daftar node.</div>
</div>
</div>
<hr>
<h2 id=pengujian>Pengujian</h2>
<p>Sekarang coba periksa lagi daftar node yang ada.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ kubectl get nodes
</code></pre></td></tr></table>
</div>
</div><p>Jika berhasil hasilnya akan menjadi seperti berikut.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-cfg data-lang=cfg><span class=na>NAME               STATUS   ROLES                  AGE     VERSION</span>
<span class=na>ip-172-31-16-20    Ready    control-plane,master   8m50s   v1.20.2</span>
<span class=na>ip-172-31-25-81    Ready    worker                 7m41s   v1.20.2</span>
<span class=na>ip-172-31-29-192   Ready    worker                 7m40s   v1.20.2</span>
</code></pre></td></tr></table>
</div>
</div><p>Periksa pod yang berjalan pada semua namespace.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ kubectl get pods --all-namespaces
</code></pre></td></tr></table>
</div>
</div><p>Hasilnya kurang lebih akan seperti berikut.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-cfg data-lang=cfg><span class=na>NAMESPACE     NAME                                      READY   STATUS    RESTARTS   AGE</span>
<span class=na>kube-system   coredns-74ff55c5b-kfzvr                   1/1     Running   0          4h56m</span>
<span class=na>kube-system   coredns-74ff55c5b-qrz2j                   1/1     Running   0          4h56m</span>
<span class=na>kube-system   etcd-ip-172-31-16-20                      1/1     Running   0          4h56m</span>
<span class=na>kube-system   kube-apiserver-ip-172-31-16-20            1/1     Running   0          4h56m</span>
<span class=na>kube-system   kube-controller-manager-ip-172-31-16-20   1/1     Running   0          4h56m</span>
<span class=na>kube-system   kube-flannel-ds-hltkg                     1/1     Running   0          4h55m</span>
<span class=na>kube-system   kube-flannel-ds-jvvbv                     1/1     Running   0          4h56m</span>
<span class=na>kube-system   kube-flannel-ds-xfdq8                     1/1     Running   0          4h55m</span>
<span class=na>kube-system   kube-proxy-67kgp                          1/1     Running   0          4h55m</span>
<span class=na>kube-system   kube-proxy-bd7cj                          1/1     Running   0          4h56m</span>
<span class=na>kube-system   kube-proxy-gjkr6                          1/1     Running   0          4h55m</span>
<span class=na>kube-system   kube-scheduler-ip-172-31-16-20            1/1     Running   0          4h56m</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id=kesimpulan>Kesimpulan</h2>
<p>Dengan menggunakan Terraform dan Ansible, kita dapat membangun klaster Kubernetes sendiri pada AWS. Salah satu keunggulan yang saya rasakan adalah fleksibilitas yang tinggi, dimana saya dapat menggunakan spesifikasi instance yang terbilang rendah untuk mencoba membangun klaster Kubernetes jika dibandingkan dengan menggunakan distribusi Kubernetes (seperti OKD atau OpenShift). Jika semua script telah tersedia, maka proses instalasi klaster bisa dikatakan sangat cepat.</p>
<hr>
<h2 id=referensi>Referensi</h2>
<ul>
<li><a href=https://registry.terraform.io/providers/hashicorp/aws/latest/docs target=_blank rel="noopener noreffer">registry.terraform.io/providers/hashicorp/aws/latest/docs</a></li>
<li><a href=https://docs.ansible.com/ansible/latest/reference_appendices/playbooks_keywords.html#playbook-keywords target=_blank rel="noopener noreffer">docs.ansible.com/ansible/latest/reference_appendices/playbooks_keywords.html</a></li>
<li><a href=https://kubernetes.io/docs/setup/production-environment/container-runtimes/#docker target=_blank rel="noopener noreffer">kubernetes.io/docs/setup/production-environment/container-runtimes/#docker</a></li>
<li><a href=https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/ target=_blank rel="noopener noreffer">kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/</a></li>
<li><a href=https://docs.aws.amazon.com/cli/latest/reference/ec2/ target=_blank rel="noopener noreffer">docs.aws.amazon.com/cli/latest/reference/ec2/</a></li>
<li><a href=https://docs.aws.amazon.com/cli/latest/userguide/cli-services-ec2-keypairs.html target=_blank rel="noopener noreffer">docs.aws.amazon.com/cli/latest/userguide/cli-services-ec2-keypairs.html</a></li>
<li><a href=https://docs.aws.amazon.com/cli/latest/userguide/cli-services-ec2-instances.html target=_blank rel="noopener noreffer">docs.aws.amazon.com/cli/latest/userguide/cli-services-ec2-instances.html</a></li>
<li><a href=https://docs.aws.amazon.com/cli/latest/reference/ec2/describe-vpcs.html target=_blank rel="noopener noreffer">docs.aws.amazon.com/cli/latest/reference/ec2/describe-vpcs.html</a></li>
<li><a href=https://blog.leonprasetya.my.id/p/setup-kubernetes-cluster-pada-aws-educate-mulai-dari-penyiapan-server-sampai-selesai/ target=_blank rel="noopener noreffer">blog.leonprasetya.my.id</a></li>
</ul></div><div class=post-footer id=post-footer>
<div class=post-info>
<div class=post-info-line>
<div class=post-info-mod>
<span>Updated on 2021-01-31</span>
</div>
<div class=post-info-license></div>
</div>
<div class=post-info-line>
<div class=post-info-md><span>
<a class=link-to-markdown href=/kubernetes-cluster-provisioning-dengan-terraform-dan-ansible/index.md target=_blank>Read Markdown</a>
</span></div>
<div class=post-info-share>
<span></span>
</div>
</div>
</div>
<div class=post-info-more>
<section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/kubernetes/>Kubernetes</a>,&nbsp;<a href=/tags/terraform/>Terraform</a>,&nbsp;<a href=/tags/ansible/>Ansible</a>,&nbsp;<a href=/tags/aws/>AWS</a></section>
<section>
<span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span>
</section>
</div>
<div class=post-nav><a href=/integrasi-sysdig-monitor-di-openshift/ class=prev rel=prev title="Integrasi Sysdig Monitor di OpenShift"><i class="fas fa-angle-left fa-fw"></i>Integrasi Sysdig Monitor di OpenShift</a>
<a href=/integrasi-github-pages-dengan-cloudflare-cdn/ class=next rel=next title="Integrasi Github Pages dengan Cloudflare CDN">Integrasi Github Pages dengan Cloudflare CDN<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id=comments><div id=disqus_thread class=comment></div><noscript>
Please enable JavaScript to view the comments powered by <a href=https://disqus.com/?ref_noscript>Disqus</a>.
</noscript></div></article></div>
</main><footer class=footer>
<div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=http://github.com/anwareset target=_blank>anwareset</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div>
</div>
</footer></div>
<div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top">
<i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments">
<i class="fas fa-comment fa-fw"></i>
</a>
</div><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><script type=text/javascript src=https://anwars-blog.disqus.com/embed.js defer></script><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/typeit/typeit.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:10},comment:{},data:{"id-1":"init\u0026nbsp","id-2":"init\u0026nbsp"},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"},typeit:{cursorChar:"\u0026nbsp _",cursorSpeed:1e3,data:{"id-1":["id-1"],"id-2":["id-2"]},duration:-1,speed:75}}</script><script type=text/javascript src=/js/theme.min.js></script></body>
</html>